<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Christian L. Goueguel">
<meta name="dcterms.date" content="2025-08-23">
<meta name="description" content="Traditional data analysis methods often rely on matrices, but when applied to complex, multimodal datasets they can struggle to uncover meaningful latent structures. High-order (multiway) data analysis extends beyond the two-dimensional matrix framework, providing more powerful tools for identifying patterns and relationships in multi-dimensional data. In this post, I review two cornerstone techniques (PARAFAC and Tucker) which generalize familiar methods like singular value decomposition (SVD) and bilinear principal component analysis (PCA) to higher-order tensors.">

<title>Tensor Decomposition: PARAFAC and Tucker – Christian L. Goueguel</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/CG_logo.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-59898bd1c6b9d2bb783127feaa000c76.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-31b9530883ebc8fc8a89f385194d4a02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../styles.scss">
<meta property="og:title" content="Tensor Decomposition: PARAFAC and Tucker – Christian L. Goueguel">
<meta property="og:description" content="Traditional data analysis methods often rely on matrices, but when applied to complex, multimodal datasets they can struggle to uncover meaningful latent structures. High-order (multiway) data analysis extends beyond the two-dimensional matrix framework, providing more powerful tools for identifying patterns and relationships in multi-dimensional data. In this post, I review two cornerstone techniques (PARAFAC and Tucker) which generalize familiar methods like singular value decomposition (SVD) and bilinear principal component analysis (PCA) to higher-order tensors.">
<meta property="og:image" content="https://christiangoueguel.com/blog/posts/post10/cover.jpg">
<meta property="og:site_name" content="Christian L. Goueguel">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Christian L. Goueguel</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../bio.html"> 
<span class="menu-text">ABOUT</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../research.html"> 
<span class="menu-text">RESEARCH</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../publications.html"> 
<span class="menu-text">PUBLICATIONS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../talks.html"> 
<span class="menu-text">TALKS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../projects/index.html"> 
<span class="menu-text">PROJECTS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../photography.html"> 
<span class="menu-text">PHOTOGRAPHY</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../blog/index.html"> 
<span class="menu-text">BLOG</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/ChristianGoueguel" title="" class="quarto-navigation-tool px-1" aria-label="" target="_blank"><i class="bi bi-github"></i></a>
    <a href="https://www.linkedin.com/in/christiangoueguel" title="" class="quarto-navigation-tool px-1" aria-label="" target="_blank"><i class="bi bi-linkedin"></i></a>
    <a href="https://scholar.google.ca/citations?user=RTSTmL0AAAAJ&amp;hl=en" title="" class="quarto-navigation-tool px-1" aria-label="" target="_blank"><i class="bi bi-google scholar"></i></a>
    <a href="https://www.researchgate.net/profile/Christian-Goueguel" title="" class="quarto-navigation-tool px-1" aria-label="" target="_blank"><i class="bi bi-r-square"></i></a>
    <a href="https://medium.com/@christian.goueguel" title="" class="quarto-navigation-tool px-1" aria-label="" target="_blank"><i class="bi bi-medium"></i></a>
    <a href="mailto:christian.goueguel@gmail.com" title="" class="quarto-navigation-tool px-1" aria-label="email"><i class="bi bi-envelope-at"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tensor Decomposition: PARAFAC and Tucker</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Tensor Decomposition</div>
    <div class="quarto-category">PARAFAC</div>
    <div class="quarto-category">Tucker3</div>
    <div class="quarto-category">Python</div>
  </div>
  </div>

<div>
  <div class="description">
    <p>Traditional data analysis methods often rely on matrices, but when applied to complex, multimodal datasets they can struggle to uncover meaningful latent structures. High-order (multiway) data analysis extends beyond the two-dimensional matrix framework, providing more powerful tools for identifying patterns and relationships in multi-dimensional data. In this post, I review two cornerstone techniques (PARAFAC and Tucker) which generalize familiar methods like singular value decomposition (SVD) and bilinear principal component analysis (PCA) to higher-order tensors.</p>
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Christian L. Goueguel </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 23, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="justified">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="cover.jpg" class="img-fluid figure-img"></p>
<figcaption>Photo by <a href="Photo by <a href=&quot;https://unsplash.com/@corina?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash&quot;>corina ardeleanu</a> on <a href=&quot;https://unsplash.com/photos/red-poppy-flower-field-at-daytime-sWlxCweDzzs?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash&quot;>Unsplash</a>">Corina Ardeleanu</a>.</figcaption>
</figure>
</div>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>In many areas of science, like spectroscopy, data are usually stored as vectors or matrices. But in real life, data often have more than two dimensions. For example, measurements that vary across time, space, and different conditions all at once. To work with these kinds of multi-dimensional datasets, we use&nbsp;multi-linear algebra. It’s the higher-dimensional version of linear algebra. Just as a matrix can be broken down with tools like Singular Value Decomposition (SVD) or Eigenvalue Decomposition (EVD) these larger data structures can also be decomposed with special methods. These decompositions help us find patterns that would be hidden if we only looked at two-dimensional data.</p>
<p>For example,&nbsp;Excitation-Emission Matrix (EEM) fluorescence spectroscopy&nbsp;and&nbsp;hyperspectral imaging&nbsp;naturally produce three-dimensional data.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image1.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" width="500"></p>
</figure>
</div>
<p>In situation where the collected data are not intrinsically 3-ways but rather tidy (<span class="math inline">\(i\)</span> observations ×&nbsp;<span class="math inline">\(j\)</span> variables), we can add for instance “time” as a third mode, in order to have three inputs (<span class="math inline">\(i\)</span> observations ×&nbsp;<span class="math inline">\(j\)</span> variables ×&nbsp;<span class="math inline">\(k\)</span> time). In other words, by adding an additional modality, we obtain a collection of matrices structured in a table with three entries called&nbsp;third-order tensor. Likewise, if we add “days” as the fourth mode into the previous data (<span class="math inline">\(i\)</span> observations ×&nbsp;<span class="math inline">\(j\)</span> variables ×&nbsp;<span class="math inline">\(k\)</span> time ×&nbsp;<span class="math inline">\(l\)</span> days), we obtain a&nbsp;fourth-order tensor. If “longitude” is added (<span class="math inline">\(i\)</span> observations ×&nbsp;<span class="math inline">\(j\)</span> variables ×&nbsp;<span class="math inline">\(k\)</span> time ×&nbsp;<span class="math inline">\(l\)</span> days ×&nbsp;<span class="math inline">\(m\)</span> longitude), we obtain a&nbsp;fifth-order tensor, and so forth<em>.</em> Intuitively we can see that an order-<span class="math inline">\(N\)</span>&nbsp;tensor is the number of modes or ways , or&nbsp;<span class="math inline">\(N\)</span>-dimensional arrays. In the following we will only consider data arranged as third-order tensor  <span class="math inline">\(i.e.\)</span><em>,</em>&nbsp;3-way data.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image2.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" width="500"></p>
</figure>
</div>
<section id="third-oder-tensor" class="level3">
<h3 class="anchored" data-anchor-id="third-oder-tensor">Third-Oder Tensor</h3>
<p>Let <span class="math inline">\(T\)</span>&nbsp;be an array with three entries, three matrix representations can be associated with this array:</p>
<p><span class="math inline">\(T\)</span>&nbsp;can be seen as 3 different collections of matrices. These collections are called horizontal, vertical and frontal slices. The matrices of each collection have the same dimension.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image3.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" width="500"></p>
</figure>
</div>
<p><span class="math inline">\(T\)</span>&nbsp;can be considered successively as three matrices called “representations n mode”. The process of reorganizing&nbsp;<span class="math inline">\(T\)</span>&nbsp;in these three forms is called matricization (or mode-<span class="math inline">\(k\)</span> flattening).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image4.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" width="300"></p>
</figure>
</div>
<p><span class="math inline">\(T\)</span>&nbsp;can be seen as three collections of vectors. Each collection is a table with 2 entries, the elements of which are vectors of the same dimension also called “fibers”.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image5.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" width="500"></p>
</figure>
</div>
</section>
</section>
<section id="tensor-decomposition" class="level2">
<h2 class="anchored" data-anchor-id="tensor-decomposition">Tensor Decomposition</h2>
<section id="parafac" class="level3">
<h3 class="anchored" data-anchor-id="parafac">PARAFAC</h3>
<p>PARAFAC (Parallel Factor Analysis) also called Canonical Polyadic (CP) is the simplest and most widely used&nbsp;three-way decomposition. Introduced independently by <a href="https://pdfs.semanticscholar.org/c5b2/8cae82b14417f1250e58bb241367248e827d.pdf">Harshman</a>&nbsp;and, by&nbsp;<a href="https://link.springer.com/article/10.1007/BF02310791">Carrol and Chang</a> (who called it Canonical Decomposition or CANDECOMP), PARAFAC represents the most intuitive extension of familiar techniques like Principal Component Analysis (PCA) into the three-dimensional world. PARAFAC is express by:</p>
<p><span class="math display">\[
\mathbf{X} \approx \sum_{r=1}^{R} \lambda_r \cdot (\mathbf{a}_r \otimes \mathbf{b}_r \otimes \mathbf{c}_r)
\]</span></p>
<p>This equation tells us that a 3D tensor <span class="math inline">\(\textbf{X}\)</span> can be approximated as a sum of <span class="math inline">\(R\)</span> simple components, where each component is the outer product <span class="math inline">\((\otimes)\)</span> of three vectors: <span class="math inline">\(\textbf{a}_r\)</span> from mode 1, <span class="math inline">\(\textbf{b}_r\)</span> from mode 2, and <span class="math inline">\(\textbf{c}_r\)</span> from mode 3, scaled by weight <span class="math inline">\(\lambda_r\)</span>.</p>
<p>One of the defining strengths of PARAFAC is that it applies the same number of components (R) across all modes and, under mild conditions, guarantees a unique decomposition. This property of&nbsp;uniqueness&nbsp;is extremely valuable: unlike many other factorization methods, PARAFAC can recover the “true” underlying factors without ambiguity. As a result, it provides not just a mathematical approximation but an interpretable solution that reflects real-world structure. This makes PARAFAC a powerful tool for scientific discovery, with broad applications in spectroscopy, neuroscience, signal processing, and beyond.</p>
</section>
<section id="tucker3" class="level3">
<h3 class="anchored" data-anchor-id="tucker3">Tucker3</h3>
<p>Tucker3 takes a more sophisticated approach, like having an adjustable toolbox instead of a master key. While PARAFAC forces all modes to have the same number of components, Tucker3 allows each mode to have its own optimal number of factors. The Tucker3 decomposition follows this structure:</p>
<p><span class="math display">\[
\mathbf{X} \approx \mathbf{G} \times_1 \mathbf{A} \times_2 \mathbf{B} \times_3 \mathbf{C}
\]</span></p>
<p>Here, <span class="math inline">\(\textbf{G}\)</span> is the core tensor that acts as a “weighting grid,” determining how strongly each combination of factors from different modes interacts. The <span class="math inline">\(×₁\)</span>, <span class="math inline">\(×₂\)</span>, <span class="math inline">\(×₃\)</span> symbols represent tensor contractions. Think of them as sophisticated ways of combining the core tensor with factor matrices <span class="math inline">\(\textbf{A}\)</span>, <span class="math inline">\(\textbf{B}\)</span>, and <span class="math inline">\(\textbf{C}\)</span>.</p>
<p>Unlike PARAFAC’s simple sum, Tucker3 creates a weighted combination where the core tensor <span class="math inline">\(\textbf{G}\)</span> contains elements <span class="math inline">\(g_{i,j,k}\)</span> that specify how factors from mode 1 (position <span class="math inline">\(i\)</span>), mode 2 (position <span class="math inline">\(j\)</span>), and mode 3 (position <span class="math inline">\(k\)</span>) combine together. This flexibility allows Tucker3 to capture more complex interaction patterns that PARAFAC might miss.</p>
</section>
</section>
<section id="implementation" class="level2">
<h2 class="anchored" data-anchor-id="implementation">Implementation</h2>
<p>In the examples below, we demonstrate a practical implementation of tensor decomposition methods using the Python library <a href="https://tensorly.org/dev/index.html">TensorLy</a>. In the first example, we built and used a synthetic dataset composed of three Gaussian distribution patterns, illustrating how PARAFAC decomposition can effectively capture and uncovored underlying structures in a noisy multidimensional data. In the second example, we use a published dataset that captures how our tongues move when we speak. Using this dataset, we will compare PARAFAC and Tucker decomposition, highlighting the differences in how each method captures the underlying structures of a complex multidimensional data.</p>
<section id="python-libraries" class="level3">
<h3 class="anchored" data-anchor-id="python-libraries">Python libraries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> pearsonr</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.mplot3d <span class="im">import</span> Axes3D</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> starmap</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For our tensor decomposition analysis, we rely on <a href="https://tensorly.org/dev/index.html">TensorLy</a>, a powerful Python library specifically designed for multilinear algebra and tensor operations. TensorLy provides a unified, user-friendly interface for tensor computations while maintaining computational efficiency through optimized backends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorly <span class="im">as</span> tl</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorly.decomposition <span class="im">import</span> parafac, tucker</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorly.cp_tensor <span class="im">import</span> cp_to_tensor</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorly.tucker_tensor <span class="im">import</span> tucker_to_tensor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also specify the computational backend with <code>tl.set_backend('numpy')</code>, which determines how TensorLy performs its underlying mathematical operations. TensorLy supports multiple backends including <code>NumPy</code>, <code>PyTorch</code>, <code>TensorFlow</code>, and <code>JAX</code>, each offering different advantages depending on the application. For more details see <a href="https://tensorly.org/dev/user_guide/quickstart.html#tensorly-backend">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>tl.set_backend(<span class="st">'numpy'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="example-1" class="level3">
<h3 class="anchored" data-anchor-id="example-1">Example 1</h3>
<p>The bivariate Gaussian distribution with means <span class="math inline">\(\mu_x,\mu_y\)</span>, standards deviations <span class="math inline">\(\sigma_x, \sigma_y\)</span>, and correlation coefficient <span class="math inline">\(\rho\)</span>, is given by:</p>
<p><span class="math display">\[
f(x, y) = \frac{1}{2\pi \sigma_x \sigma_y \sqrt{1 - \rho^2}} \exp\left( -\frac{1}{2(1 - \rho^2)} \left[ \left( \frac{x - \mu_x}{\sigma_x} \right)^2 - 2\rho \left( \frac{x - \mu_x}{\sigma_x} \right) \left( \frac{y - \mu_y}{\sigma_y} \right) + \left( \frac{y - \mu_y}{\sigma_y} \right)^2 \right] \right)
\]</span></p>
<p>We consider the simplified 2D Gaussian distribution when <span class="math inline">\(\rho = 0\)</span> (i.e., no correlation between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>):</p>
<p><span class="math display">\[
f(x, y) = \frac{1}{2\pi \sigma_x \sigma_y} \exp\left( - \frac{1}{2} \left[ \left( \frac{x - \mu_x}{\sigma_x} \right)^2 + \left( \frac{y - \mu_y}{\sigma_y} \right)^2 \right] \right)
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gaussian_distribution(x, y, mu<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">0</span>), sigma<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>), amplitude<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  alpha <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> math.pi <span class="op">*</span> mu[<span class="dv">0</span>] <span class="op">*</span> mu[<span class="dv">1</span>])</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  beta_x <span class="op">=</span> ((x <span class="op">-</span> mu[<span class="dv">0</span>]) <span class="op">/</span> sigma[<span class="dv">0</span>])<span class="op">**</span><span class="dv">2</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  beta_y <span class="op">=</span> ((y <span class="op">-</span> mu[<span class="dv">1</span>]) <span class="op">/</span> sigma[<span class="dv">1</span>])<span class="op">**</span><span class="dv">2</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  beta <span class="op">=</span> beta_x <span class="op">+</span> beta_y</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> amplitude <span class="op">*</span> alpha <span class="op">*</span> np.exp(<span class="op">-</span>(<span class="dv">1</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> beta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s built three different Gaussian distributions with specific characteristics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">100</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">100</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>X, Y <span class="op">=</span> np.meshgrid(x, y)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Broad distribution</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>broad <span class="op">=</span> gaussian_distribution(X, Y, (<span class="op">-</span><span class="dv">2</span>, <span class="op">-</span><span class="dv">2</span>), (<span class="dv">2</span>, <span class="dv">2</span>), <span class="dv">1</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Two peaks</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>peak1 <span class="op">=</span> gaussian_distribution(X, <span class="op">-</span>Y, (<span class="fl">1.5</span>, <span class="fl">1.5</span>), (<span class="fl">0.8</span>, <span class="fl">0.8</span>), <span class="dv">1</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>peak2 <span class="op">=</span> gaussian_distribution(<span class="op">-</span>X, Y, (<span class="dv">2</span>, <span class="dv">2</span>), (<span class="fl">0.8</span>, <span class="fl">0.8</span>), <span class="dv">2</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>twopeaks <span class="op">=</span> peak1 <span class="op">+</span> peak2 </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Sharp distribution</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>sharp <span class="op">=</span> gaussian_distribution(X, Y, (<span class="dv">1</span>, <span class="dv">1</span>), (<span class="fl">0.2</span>, <span class="fl">0.2</span>), <span class="fl">1.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we stack the three distributions into a tensor of dimension <span class="math inline">\(100 \times 100 \times 3\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> np.stack([broad, twopeaks, sharp], axis<span class="op">=-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now visualize the three distributions to verify their shapes and characteristics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">3</span>, i<span class="op">+</span><span class="dv">1</span>, projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    surf <span class="op">=</span> ax.plot_surface(X, Y, T[:, :, i], cmap<span class="op">=</span><span class="st">'viridis'</span>, linewidth<span class="op">=</span><span class="dv">0</span>, antialiased<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'X-Position'</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Y-Position'</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the purpose of this post, we add some noise into the data at three distinct levels: <strong>0.001</strong>, <strong>0.01</strong>, and <strong>0.05</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>noisy1_T <span class="op">=</span> T <span class="op">+</span> <span class="fl">0.001</span> <span class="op">*</span> np.random.randn(<span class="op">*</span>T.shape)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>noisy2_T <span class="op">=</span> T <span class="op">+</span> <span class="fl">0.01</span> <span class="op">*</span> np.random.randn(<span class="op">*</span>T.shape)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>noisy3_T <span class="op">=</span> T <span class="op">+</span> <span class="fl">0.05</span> <span class="op">*</span> np.random.randn(<span class="op">*</span>T.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we create a list of tensors to decompose, e.g., <code>[noisy1_T, noisy2_T, noisy3_T]</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>datasets <span class="op">=</span> [noisy1_T, noisy2_T, noisy3_T]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>noise_levels <span class="op">=</span> [<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>titles <span class="op">=</span> [<span class="st">'Broad'</span>, <span class="st">'Two-peak'</span>, <span class="st">'Sharp'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_tensor(data, noise):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="ss">f"Noise level = </span><span class="sc">{</span>noise<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">3</span>, i<span class="op">+</span><span class="dv">1</span>, projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        surf <span class="op">=</span> ax.plot_surface(X, Y, data[:, :, i], cmap<span class="op">=</span><span class="st">'viridis'</span>, linewidth<span class="op">=</span><span class="dv">0</span>, antialiased<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'X-Position'</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'Y-Position'</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">map</span>(plot_tensor, datasets, noise_levels):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-14-3.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-14-4.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-14-5.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>PARAFAC decomposition is applied iteratively to the list of tensors. For each tensor in <code>datasets</code>, the method extracts three components, producing a set of <code>weights</code> and <code>factor</code> matrices that capture the underlying patterns along each mode:</p>
<ul>
<li>Mode 0 factors: describe the pattern along the rows (X-axis) of the tensor.</li>
<li>Mode 1 factors: describe the pattern along the columns (Y-axis) of the tensor.</li>
<li>Mode 2 factors: correspond to the the different Gaussian distributions.</li>
</ul>
<p>All of these results are collected and stored in a list called <code>results</code>, for further analysis and visualization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> data: parafac(data, <span class="dv">3</span>, init<span class="op">=</span><span class="st">'random'</span>, random_state<span class="op">=</span><span class="dv">42</span>), datasets))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then reconstruct the tensor from the factorization results and evaluate the quality of the decomposition by calculating the relative reconstruction error. The reconstructed tensor is obtained using the factor matrices and weights returned by the PARAFAC model. The error is computed as the ratio between the Frobenius norm, <span class="math inline">\(\lVert{\cdot}\rVert_F\)</span>, of the difference (original tensor minus reconstructed tensor) and the Frobenius norm of the original tensor. This provides a normalized measure of how well the decomposition approximates the data, with lower values indicating a more accurate reconstruction.</p>
<p><span class="math display">\[
\text{Relative Reconstruction Error} = \frac{\lVert\mathcal{T} - \hat{\mathcal{T}}\rVert_F}{\lVert \mathcal{T}\rVert_F}
\]</span></p>
<p>Where <span class="math inline">\(\mathcal{T}\)</span> is the original tensor and <span class="math inline">\(\lVert \mathcal{\hat{T}} \rVert_F\)</span> is the reconstructed tensor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_error(result, data):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  weights, factors <span class="op">=</span> result</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  reconstructed_T <span class="op">=</span> cp_to_tensor((weights, factors))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> np.linalg.norm(data <span class="op">-</span> reconstructed_T) <span class="op">/</span> np.linalg.norm(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>errors <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(compute_error, results, datasets))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> noise, err <span class="kw">in</span> <span class="bu">zip</span>(noise_levels, errors):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Noise level = </span><span class="sc">{</span>noise<span class="sc">}</span><span class="ss">, Relative reconstruction error = </span><span class="sc">{</span>err<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Noise level = 0.001, Relative reconstruction error = 0.3160
Noise level = 0.01, Relative reconstruction error = 0.6662
Noise level = 0.05, Relative reconstruction error = 0.9623</code></pre>
</div>
</div>
<p>Next, we visualize the decomposed modes obtained from the tensor factorization. Each of the three component represents a distinct pattern captured along a specific mode of the data, and plotting them allows us to interpret the underlying structures identified by the decomposition.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>titles <span class="op">=</span> [<span class="st">'Component 1'</span>, <span class="st">'Component 2'</span>, <span class="st">'Component 3'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_components(result, noise):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    weights, factors <span class="op">=</span> result</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="ss">f"Noise level = </span><span class="sc">{</span>noise<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(axes):</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        component <span class="op">=</span> np.outer(factors[<span class="dv">0</span>][:, i], factors[<span class="dv">1</span>][:, i])</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        component <span class="op">/=</span> np.<span class="bu">max</span>(np.<span class="bu">abs</span>(component))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        line_y <span class="op">=</span> component.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        line_x <span class="op">=</span> component.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        ax.plot(line_y, label<span class="op">=</span><span class="st">'Mode 1 (Y-position)'</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        ax.plot(line_x, label<span class="op">=</span><span class="st">'Mode 0 (X-position)'</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        ax.set_title(titles[i])</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'Index'</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'Amplitude (normalized)'</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">map</span>(plot_components, results, noise_levels):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-21-9.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-21-10.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-21-11.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>titles <span class="op">=</span> [<span class="st">'Broad'</span>, <span class="st">'Two-peak'</span>, <span class="st">'Sharp'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_reconstruction_error(noisy, reconstructed, noise_level):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    error_tensor <span class="op">=</span> noisy <span class="op">-</span> reconstructed</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="ss">f'Reconstruction Error - Noise level = </span><span class="sc">{</span>noise_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(axes):</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> ax.imshow(error_tensor[:, :, i], cmap<span class="op">=</span><span class="st">'RdBu'</span>, aspect<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        ax.set_title(titles[i])</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        fig.colorbar(im, ax<span class="op">=</span>ax, label<span class="op">=</span><span class="st">'Error'</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>reconstructed_tensors <span class="op">=</span> [cp_to_tensor(res) <span class="cf">for</span> res <span class="kw">in</span> results]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">map</span>(plot_reconstruction_error, datasets, reconstructed_tensors, noise_levels):</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-24-15.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-24-16.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-24-17.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="example-2" class="level3">
<h3 class="anchored" data-anchor-id="example-2">Example 2</h3>
<p>In this example, we use a fascinating dataset from pioneering linguistic research by Ladefoged et al.&nbsp;(1971), that captures how our tongues move when we speak. The study used X-ray imaging to study tongue shapes as five different speakers pronounced various English vowels. By mapping tongue positions onto a defined grid, they created a unique 3D dataset that reveals the biomechanics of human speech.</p>
<p>The tensor has dimensions <span class="math inline">\(5 \times 10 \times 13\)</span>, representing:</p>
<ul>
<li>5 speakers (different individuals)</li>
<li>10 vowels (various English vowel sounds)</li>
<li>13 grid positions (spatial measurements in centimeters)</li>
</ul>
<p>This creates a rich, multi-dimensional dataset perfect for demonstrating tensor decomposition techniques. The original study aimed to identify the fundamental patterns underlying tongue movement during speech. The data was preprocessed by centering across vowels, and the researchers found evidence for two definitive components in the speech patterns, with a possible third component that couldn’t be reliably established. This real-world complexity makes it an excellent example for comparing different tensor decomposition methods like PARAFAC and Tucker, as it contains the kind of structural challenges often found in genuine scientific data. For complete experimental details, see the <a href="https://pubs.aip.org/asa/jasa/article/50/1A_Supplement/140/638102/Factor-Analyses-of-Tongue-Shapes">original research paper</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.array([</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.45</span>, <span class="fl">2.40</span>, <span class="fl">2.40</span>, <span class="fl">2.50</span>, <span class="fl">2.45</span>, <span class="fl">2.05</span>, <span class="fl">1.65</span>, <span class="fl">1.00</span>, <span class="fl">0.45</span>, <span class="fl">0.40</span>, <span class="fl">0.55</span>, <span class="fl">0.55</span>, <span class="fl">0.95</span>],</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.55</span>, <span class="fl">2.05</span>, <span class="fl">1.95</span>, <span class="fl">1.90</span>, <span class="fl">1.80</span>, <span class="fl">1.60</span>, <span class="fl">1.30</span>, <span class="fl">0.95</span>, <span class="fl">0.55</span>, <span class="fl">0.65</span>, <span class="fl">0.90</span>, <span class="fl">0.90</span>, <span class="fl">1.05</span>],</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.35</span>, <span class="fl">1.90</span>, <span class="fl">1.80</span>, <span class="fl">1.80</span>, <span class="fl">1.80</span>, <span class="fl">1.55</span>, <span class="fl">1.30</span>, <span class="fl">0.95</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.90</span>, <span class="fl">0.85</span>, <span class="fl">1.05</span>],</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.50</span>, <span class="fl">2.05</span>, <span class="fl">1.65</span>, <span class="fl">1.65</span>, <span class="fl">1.55</span>, <span class="fl">1.45</span>, <span class="fl">1.25</span>, <span class="fl">1.05</span>, <span class="fl">0.70</span>, <span class="fl">1.05</span>, <span class="fl">1.20</span>, <span class="fl">1.15</span>, <span class="fl">1.10</span>],</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.05</span>, <span class="fl">1.50</span>, <span class="fl">1.35</span>, <span class="fl">1.50</span>, <span class="fl">1.55</span>, <span class="fl">1.45</span>, <span class="fl">1.30</span>, <span class="fl">1.15</span>, <span class="fl">0.95</span>, <span class="fl">1.40</span>, <span class="fl">1.55</span>, <span class="fl">1.40</span>, <span class="fl">1.25</span>],</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.55</span>, <span class="fl">1.00</span>, <span class="fl">0.85</span>, <span class="fl">1.00</span>, <span class="fl">1.25</span>, <span class="fl">1.35</span>, <span class="fl">1.50</span>, <span class="fl">2.00</span>, <span class="fl">2.10</span>, <span class="fl">2.55</span>, <span class="fl">2.65</span>, <span class="fl">2.35</span>, <span class="fl">2.00</span>],</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.65</span>, <span class="fl">0.90</span>, <span class="fl">0.65</span>, <span class="fl">0.65</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span>, <span class="fl">1.40</span>, <span class="fl">1.90</span>, <span class="fl">2.15</span>, <span class="fl">2.60</span>, <span class="fl">2.70</span>, <span class="fl">2.60</span>, <span class="fl">2.40</span>],</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.90</span>, <span class="fl">1.30</span>, <span class="fl">0.95</span>, <span class="fl">0.85</span>, <span class="fl">0.75</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span>, <span class="fl">1.30</span>, <span class="fl">1.65</span>, <span class="fl">2.15</span>, <span class="fl">2.30</span>, <span class="fl">2.25</span>, <span class="fl">2.30</span>],</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.40</span>, <span class="fl">1.60</span>, <span class="fl">1.45</span>, <span class="fl">1.25</span>, <span class="fl">1.00</span>, <span class="fl">0.95</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">1.10</span>, <span class="fl">1.50</span>, <span class="fl">2.10</span>, <span class="fl">2.00</span>, <span class="fl">1.65</span>],</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.70</span>, <span class="fl">1.95</span>, <span class="fl">1.50</span>, <span class="fl">1.30</span>, <span class="fl">0.90</span>, <span class="fl">0.70</span>, <span class="fl">0.55</span>, <span class="fl">0.55</span>, <span class="fl">0.95</span>, <span class="fl">1.45</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>],</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.95</span>, <span class="fl">2.70</span>, <span class="fl">2.75</span>, <span class="fl">2.75</span>, <span class="fl">2.70</span>, <span class="fl">2.60</span>, <span class="fl">2.25</span>, <span class="fl">1.00</span>, <span class="fl">0.35</span>, <span class="fl">0.15</span>, <span class="fl">0.30</span>, <span class="fl">0.60</span>, <span class="fl">1.15</span>],</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.40</span>, <span class="fl">2.20</span>, <span class="fl">2.25</span>, <span class="fl">2.20</span>, <span class="fl">2.25</span>, <span class="fl">2.15</span>, <span class="fl">1.85</span>, <span class="fl">1.25</span>, <span class="fl">0.75</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>, <span class="fl">1.05</span>, <span class="fl">1.10</span>],</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.25</span>, <span class="fl">2.45</span>, <span class="fl">2.65</span>, <span class="fl">2.65</span>, <span class="fl">2.40</span>, <span class="fl">2.20</span>, <span class="fl">2.05</span>, <span class="fl">1.55</span>, <span class="fl">0.95</span>, <span class="fl">0.85</span>, <span class="fl">1.10</span>, <span class="fl">1.40</span>, <span class="fl">1.65</span>],</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.00</span>, <span class="fl">1.75</span>, <span class="fl">1.90</span>, <span class="fl">2.30</span>, <span class="fl">2.40</span>, <span class="fl">2.20</span>, <span class="fl">2.00</span>, <span class="fl">1.45</span>, <span class="fl">1.00</span>, <span class="fl">1.05</span>, <span class="fl">1.40</span>, <span class="fl">1.75</span>, <span class="fl">1.80</span>],</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.25</span>, <span class="fl">1.15</span>, <span class="fl">1.30</span>, <span class="fl">1.65</span>, <span class="fl">1.95</span>, <span class="fl">1.90</span>, <span class="fl">1.80</span>, <span class="fl">1.65</span>, <span class="fl">1.40</span>, <span class="fl">1.70</span>, <span class="fl">2.15</span>, <span class="fl">2.45</span>, <span class="fl">2.60</span>],</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.45</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">1.15</span>, <span class="fl">1.70</span>, <span class="fl">1.95</span>, <span class="fl">2.30</span>, <span class="fl">2.60</span>, <span class="fl">2.95</span>, <span class="fl">3.30</span>, <span class="fl">3.15</span>, <span class="fl">2.60</span>],</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.40</span>, <span class="fl">0.20</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.60</span>, <span class="fl">1.05</span>, <span class="fl">1.35</span>, <span class="fl">1.65</span>, <span class="fl">2.60</span>, <span class="fl">3.05</span>, <span class="fl">3.45</span>, <span class="fl">3.60</span>, <span class="fl">3.40</span>],</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.00</span>, <span class="fl">0.55</span>, <span class="fl">0.55</span>, <span class="fl">0.45</span>, <span class="fl">0.65</span>, <span class="fl">0.80</span>, <span class="fl">1.15</span>, <span class="fl">1.55</span>, <span class="fl">2.25</span>, <span class="fl">2.75</span>, <span class="fl">3.20</span>, <span class="fl">3.35</span>, <span class="fl">3.25</span>],</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.30</span>, <span class="fl">0.70</span>, <span class="fl">0.65</span>, <span class="fl">0.45</span>, <span class="fl">0.65</span>, <span class="fl">0.90</span>, <span class="fl">1.20</span>, <span class="fl">1.45</span>, <span class="fl">1.90</span>, <span class="fl">2.40</span>, <span class="fl">2.85</span>, <span class="fl">2.80</span>, <span class="fl">2.45</span>],</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.15</span>, <span class="fl">1.80</span>, <span class="fl">1.50</span>, <span class="fl">1.05</span>, <span class="fl">0.65</span>, <span class="fl">0.55</span>, <span class="fl">0.65</span>, <span class="fl">0.80</span>, <span class="fl">0.95</span>, <span class="fl">1.55</span>, <span class="fl">2.10</span>, <span class="fl">2.35</span>, <span class="fl">2.60</span>],</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.10</span>, <span class="fl">2.00</span>, <span class="fl">2.15</span>, <span class="fl">2.05</span>, <span class="fl">1.95</span>, <span class="fl">1.80</span>, <span class="fl">1.45</span>, <span class="fl">1.10</span>, <span class="fl">0.75</span>, <span class="fl">0.65</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>],</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.00</span>, <span class="fl">1.70</span>, <span class="fl">1.90</span>, <span class="fl">1.95</span>, <span class="fl">1.90</span>, <span class="fl">1.75</span>, <span class="fl">1.35</span>, <span class="fl">1.15</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>, <span class="fl">1.10</span>, <span class="fl">0.90</span>, <span class="fl">0.65</span>],</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.95</span>, <span class="fl">1.80</span>, <span class="fl">1.80</span>, <span class="fl">1.95</span>, <span class="fl">1.95</span>, <span class="fl">1.95</span>, <span class="fl">1.65</span>, <span class="fl">1.25</span>, <span class="fl">0.90</span>, <span class="fl">0.85</span>, <span class="fl">1.05</span>, <span class="fl">0.95</span>, <span class="fl">0.90</span>],</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.55</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.70</span>, <span class="fl">1.85</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">1.80</span>, <span class="fl">1.75</span>, <span class="fl">1.70</span>, <span class="fl">1.70</span>, <span class="fl">1.40</span>, <span class="fl">1.10</span>],</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.65</span>, <span class="fl">1.25</span>, <span class="fl">1.40</span>, <span class="fl">1.70</span>, <span class="fl">1.90</span>, <span class="fl">1.95</span>, <span class="fl">2.05</span>, <span class="fl">2.10</span>, <span class="fl">1.95</span>, <span class="fl">1.95</span>, <span class="fl">2.15</span>, <span class="fl">2.10</span>, <span class="fl">1.70</span>],</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.95</span>, <span class="fl">0.55</span>, <span class="fl">0.70</span>, <span class="fl">1.15</span>, <span class="fl">1.65</span>, <span class="fl">2.20</span>, <span class="fl">2.65</span>, <span class="fl">2.95</span>, <span class="fl">3.05</span>, <span class="fl">3.20</span>, <span class="fl">3.35</span>, <span class="fl">2.95</span>, <span class="fl">1.90</span>],</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.20</span>, <span class="fl">0.65</span>, <span class="fl">0.45</span>, <span class="fl">0.65</span>, <span class="fl">0.75</span>, <span class="fl">1.00</span>, <span class="fl">1.45</span>, <span class="fl">2.10</span>, <span class="fl">2.40</span>, <span class="fl">2.65</span>, <span class="fl">2.80</span>, <span class="fl">2.55</span>, <span class="fl">1.95</span>],</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.55</span>, <span class="fl">1.45</span>, <span class="fl">1.05</span>, <span class="fl">1.15</span>, <span class="fl">1.05</span>, <span class="fl">1.00</span>, <span class="fl">1.15</span>, <span class="fl">1.45</span>, <span class="fl">1.90</span>, <span class="fl">2.40</span>, <span class="fl">2.70</span>, <span class="fl">2.65</span>, <span class="fl">1.85</span>],</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.80</span>, <span class="fl">1.05</span>, <span class="fl">1.05</span>, <span class="fl">1.05</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.15</span>, <span class="fl">1.40</span>, <span class="fl">1.65</span>, <span class="fl">1.95</span>, <span class="fl">2.15</span>, <span class="fl">1.85</span>, <span class="fl">1.50</span>],</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.00</span>, <span class="fl">1.70</span>, <span class="fl">1.40</span>, <span class="fl">1.20</span>, <span class="fl">1.00</span>, <span class="fl">0.85</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>, <span class="fl">1.10</span>, <span class="fl">1.55</span>, <span class="fl">1.80</span>, <span class="fl">1.70</span>, <span class="fl">1.25</span>],</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.70</span>, <span class="fl">2.60</span>, <span class="fl">2.55</span>, <span class="fl">2.50</span>, <span class="fl">2.45</span>, <span class="fl">2.40</span>, <span class="fl">1.80</span>, <span class="fl">1.35</span>, <span class="fl">0.70</span>, <span class="fl">0.55</span>, <span class="fl">0.75</span>, <span class="fl">0.85</span>, <span class="fl">1.85</span>],</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.25</span>, <span class="fl">1.90</span>, <span class="fl">1.85</span>, <span class="fl">1.90</span>, <span class="fl">2.15</span>, <span class="fl">2.05</span>, <span class="fl">1.85</span>, <span class="fl">1.65</span>, <span class="fl">1.35</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.90</span>, <span class="fl">1.80</span>],</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.25</span>, <span class="fl">2.20</span>, <span class="fl">2.30</span>, <span class="fl">2.25</span>, <span class="fl">2.30</span>, <span class="fl">2.20</span>, <span class="fl">1.70</span>, <span class="fl">1.45</span>, <span class="fl">0.90</span>, <span class="fl">0.90</span>, <span class="fl">1.10</span>, <span class="fl">1.25</span>, <span class="fl">1.85</span>],</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.90</span>, <span class="fl">1.50</span>, <span class="fl">1.40</span>, <span class="fl">1.40</span>, <span class="fl">1.65</span>, <span class="fl">1.75</span>, <span class="fl">1.75</span>, <span class="fl">1.85</span>, <span class="fl">1.60</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">1.65</span>, <span class="fl">1.50</span>],</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.70</span>, <span class="fl">1.20</span>, <span class="fl">1.05</span>, <span class="fl">1.05</span>, <span class="fl">1.55</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">1.85</span>, <span class="fl">2.10</span>, <span class="fl">2.35</span>, <span class="fl">2.40</span>, <span class="fl">2.25</span>],</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.05</span>, <span class="fl">0.90</span>, <span class="fl">0.45</span>, <span class="fl">0.60</span>, <span class="fl">1.45</span>, <span class="fl">2.05</span>, <span class="fl">2.90</span>, <span class="fl">2.90</span>, <span class="fl">3.00</span>, <span class="fl">3.20</span>, <span class="fl">3.35</span>, <span class="fl">2.95</span>, <span class="fl">2.15</span>],</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.90</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.55</span>, <span class="fl">1.30</span>, <span class="fl">1.80</span>, <span class="fl">2.30</span>, <span class="fl">2.80</span>, <span class="fl">3.10</span>, <span class="fl">3.40</span>, <span class="fl">3.45</span>, <span class="fl">3.00</span>, <span class="fl">2.40</span>],</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.00</span>, <span class="fl">1.30</span>, <span class="fl">1.05</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">0.90</span>, <span class="fl">1.25</span>, <span class="fl">1.65</span>, <span class="fl">1.80</span>, <span class="fl">2.30</span>, <span class="fl">2.60</span>, <span class="fl">2.60</span>, <span class="fl">1.90</span>],</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.15</span>, <span class="fl">1.70</span>, <span class="fl">1.45</span>, <span class="fl">1.30</span>, <span class="fl">1.30</span>, <span class="fl">1.25</span>, <span class="fl">1.20</span>, <span class="fl">1.35</span>, <span class="fl">1.45</span>, <span class="fl">1.95</span>, <span class="fl">2.20</span>, <span class="fl">2.25</span>, <span class="fl">1.95</span>],</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.95</span>, <span class="fl">2.30</span>, <span class="fl">2.05</span>, <span class="fl">1.80</span>, <span class="fl">1.70</span>, <span class="fl">1.45</span>, <span class="fl">1.00</span>, <span class="fl">0.80</span>, <span class="fl">0.80</span>, <span class="fl">1.15</span>, <span class="fl">1.55</span>, <span class="fl">1.90</span>, <span class="fl">1.40</span>],</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">3.00</span>, <span class="fl">2.45</span>, <span class="fl">2.30</span>, <span class="fl">2.20</span>, <span class="fl">2.10</span>, <span class="fl">1.45</span>, <span class="fl">1.15</span>, <span class="fl">0.80</span>, <span class="fl">0.40</span>, <span class="fl">0.60</span>, <span class="fl">0.45</span>, <span class="fl">0.40</span>, <span class="fl">0.85</span>],</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.40</span>, <span class="fl">2.10</span>, <span class="fl">1.95</span>, <span class="fl">1.90</span>, <span class="fl">1.80</span>, <span class="fl">1.45</span>, <span class="fl">1.10</span>, <span class="fl">0.90</span>, <span class="fl">0.70</span>, <span class="fl">0.95</span>, <span class="fl">0.95</span>, <span class="fl">0.75</span>, <span class="fl">1.10</span>],</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.50</span>, <span class="fl">2.40</span>, <span class="fl">2.20</span>, <span class="fl">2.05</span>, <span class="fl">2.05</span>, <span class="fl">1.70</span>, <span class="fl">1.30</span>, <span class="fl">0.95</span>, <span class="fl">0.65</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>, <span class="fl">0.85</span>, <span class="fl">1.20</span>],</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.25</span>, <span class="fl">2.10</span>, <span class="fl">1.95</span>, <span class="fl">1.90</span>, <span class="fl">1.90</span>, <span class="fl">1.55</span>, <span class="fl">1.15</span>, <span class="fl">1.00</span>, <span class="fl">0.90</span>, <span class="fl">1.10</span>, <span class="fl">1.05</span>, <span class="fl">0.90</span>, <span class="fl">1.25</span>],</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.70</span>, <span class="fl">1.95</span>, <span class="fl">2.05</span>, <span class="fl">2.10</span>, <span class="fl">1.95</span>, <span class="fl">1.50</span>, <span class="fl">1.15</span>, <span class="fl">1.15</span>, <span class="fl">1.10</span>, <span class="fl">1.30</span>, <span class="fl">1.30</span>, <span class="fl">1.20</span>, <span class="fl">1.45</span>],</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.40</span>, <span class="fl">0.85</span>, <span class="fl">1.05</span>, <span class="fl">1.30</span>, <span class="fl">1.55</span>, <span class="fl">1.55</span>, <span class="fl">1.65</span>, <span class="fl">2.00</span>, <span class="fl">2.40</span>, <span class="fl">2.75</span>, <span class="fl">2.80</span>, <span class="fl">2.60</span>, <span class="fl">2.35</span>],</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.10</span>, <span class="fl">0.70</span>, <span class="fl">0.70</span>, <span class="fl">0.90</span>, <span class="fl">1.15</span>, <span class="fl">1.00</span>, <span class="fl">1.20</span>, <span class="fl">1.80</span>, <span class="fl">2.40</span>, <span class="fl">2.75</span>, <span class="fl">2.80</span>, <span class="fl">2.35</span>, <span class="fl">2.05</span>],</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.80</span>, <span class="fl">1.05</span>, <span class="fl">0.75</span>, <span class="fl">0.70</span>, <span class="fl">0.70</span>, <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">1.20</span>, <span class="fl">1.85</span>, <span class="fl">2.40</span>, <span class="fl">2.45</span>, <span class="fl">2.25</span>, <span class="fl">2.40</span>],</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.90</span>, <span class="fl">1.25</span>, <span class="fl">1.05</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">0.65</span>, <span class="fl">0.65</span>, <span class="fl">1.25</span>, <span class="fl">1.85</span>, <span class="fl">2.35</span>, <span class="fl">2.35</span>, <span class="fl">2.05</span>, <span class="fl">2.30</span>],</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.70</span>, <span class="fl">2.05</span>, <span class="fl">1.65</span>, <span class="fl">1.40</span>, <span class="fl">1.15</span>, <span class="fl">0.60</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">1.15</span>, <span class="fl">1.40</span>, <span class="fl">1.60</span>, <span class="fl">1.65</span>]</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s walk through the essential steps to convert our raw data into a proper 3D tensor for analysis. First, we transpose our original data matrix. This rearranges our data so that the spatial measurements (13 grid positions) become the first dimension, which will be important for our tensor structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we’re specifying how to organize our data into a 3D structure.</p>
<ul>
<li>13 = Grid positions (spatial measurements along the tongue)</li>
<li>10 = Vowel sounds (different English vowels)</li>
<li>5 = Speakers (different individuals)</li>
</ul>
<p>Finally, the <code>.reshape()</code> function reorganizes the 637 total elements <span class="math inline">\((13 \times 49)\)</span> into our desired 3D structure while preserving the original data values. We now have a clean 3D tensor where <code>X_tensor[i, j, k]</code> represents the tongue measurement at grid position <code>i</code>, for vowel <code>j</code>, spoken by speaker <code>k</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>tensor_dims <span class="op">=</span> [<span class="dv">13</span>, <span class="dv">10</span>, <span class="dv">5</span>]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>X_tensor <span class="op">=</span> X.reshape(tensor_dims)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="parafac-decomposition" class="level3">
<h3 class="anchored" data-anchor-id="parafac-decomposition">PARAFAC decomposition</h3>
<p>In the following, we first proceed with one important step. We systematically test different ranks (complexity levels) to find the best PARAFAC decomposition for our tongue shape data. We test multiple ranks from 2 to 50, asking: <em>“How many components do we need to best represent our data?”</em></p>
<p>In doing so, we follow a systematic decomposition loop for each rank. We decompose the tensor into factor matrices using PARAFAC, then reconstruct the original tensor from these factors. We measure the error between the original and reconstructed data, and store all results for comparison. PARAFAC breaks down our 3D tensor into three factor matrices: a grid positions factor (13 × rank), a vowels factor (10 × rank), and a speakers factor (5 × rank). Think of this as finding the fundamental “building blocks” that, when combined, recreate the original tongue movement patterns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parafac_modeling(X_tensor, max_rank<span class="op">=</span><span class="dv">50</span>):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">    PARAFAC modeling</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">    X_tensor : numpy.ndarray</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Input tensor to decompose</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">    max_rank : intenger, default=50</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Maximum rank</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">    dict : Results dictionary with PARAFAC decomposition results</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    ranks_to_test <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">2</span>, max_rank <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> rank <span class="kw">in</span> ranks_to_test:</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>            factors <span class="op">=</span> parafac(</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>              X_tensor, </span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>              rank<span class="op">=</span>rank, </span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>              init<span class="op">=</span><span class="st">'random'</span>, </span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>              n_iter_max<span class="op">=</span><span class="dv">200</span>, </span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>              random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>            reconstructed <span class="op">=</span> tl.cp_to_tensor(factors)</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>            error <span class="op">=</span> tl.norm(X_tensor <span class="op">-</span> reconstructed)</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>            rel_error <span class="op">=</span> error <span class="op">/</span> tl.norm(X_tensor)</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>            results[rank] <span class="op">=</span> {</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>                <span class="st">'factors'</span>: factors,</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>                <span class="st">'reconstructed'</span>: reconstructed,</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>                <span class="st">'error'</span>: error,</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>                <span class="st">'rel_error'</span>: rel_error</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f" Models failed..."</span>)</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>            results[rank] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optimal_rank(model, criteria<span class="op">=</span><span class="st">'elbow'</span>):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Analyze and suggest optimal rank based on different criteria</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    ranks <span class="op">=</span> []</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    rel_errors <span class="op">=</span> []</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> rank, result <span class="kw">in</span> model.items():</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> result <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>            ranks.append(rank)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>            rel_errors.append(result[<span class="st">'rel_error'</span>])</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    ranks <span class="op">=</span> np.array(ranks)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    rel_errors <span class="op">=</span> np.array(rel_errors)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    best_rank <span class="op">=</span> ranks[np.argmin(rel_errors)]</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    best_error <span class="op">=</span> np.<span class="bu">min</span>(rel_errors)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f" Best overall rank: </span><span class="sc">{</span>best_rank<span class="sc">}</span><span class="ss"> (error: </span><span class="sc">{</span>best_error<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">%)"</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(ranks) <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>        first_diff <span class="op">=</span> np.diff(rel_errors)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>        second_diff <span class="op">=</span> np.diff(first_diff)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(second_diff) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>            second_diff_ranks <span class="op">=</span> ranks[<span class="dv">2</span>:<span class="bu">len</span>(second_diff)<span class="op">+</span><span class="dv">2</span>]</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>            small_second_diff_mask <span class="op">=</span> np.<span class="bu">abs</span>(second_diff) <span class="op">&lt;</span> <span class="fl">0.001</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> np.<span class="bu">any</span>(small_second_diff_mask):</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>                elbow_rank <span class="op">=</span> second_diff_ranks[small_second_diff_mask][<span class="dv">0</span>]</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>                elbow_error <span class="op">=</span> rel_errors[ranks <span class="op">==</span> elbow_rank][<span class="dv">0</span>]</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f" Elbow point: Rank </span><span class="sc">{</span>elbow_rank<span class="sc">}</span><span class="ss"> (error: </span><span class="sc">{</span>elbow_error<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">%)"</span>)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>                max_reduction_idx <span class="op">=</span> np.argmax(np.<span class="bu">abs</span>(first_diff))</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> max_reduction_idx <span class="op">&lt;</span> <span class="bu">len</span>(ranks) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>                    elbow_rank <span class="op">=</span> ranks[max_reduction_idx <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>                    elbow_error <span class="op">=</span> rel_errors[max_reduction_idx <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f" Largest improvement at: Rank </span><span class="sc">{</span>elbow_rank<span class="sc">}</span><span class="ss"> (error: </span><span class="sc">{</span>elbow_error<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">%)"</span>)</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"> Recommendations:"</span>)</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    good_ranks <span class="op">=</span> ranks[rel_errors <span class="op">&lt;</span> <span class="fl">0.05</span>]</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(good_ranks) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>        practical_rank <span class="op">=</span> good_ranks[<span class="dv">0</span>]  <span class="co"># First rank with &lt; 5% error</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>        practical_error <span class="op">=</span> rel_errors[ranks <span class="op">==</span> practical_rank][<span class="dv">0</span>]</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   • For &lt; 5% error: Rank </span><span class="sc">{</span>practical_rank<span class="sc">}</span><span class="ss"> (error: </span><span class="sc">{</span>practical_error<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">%)"</span>)</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>    excellent_ranks <span class="op">=</span> ranks[rel_errors <span class="op">&lt;</span> <span class="fl">0.01</span>]</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(excellent_ranks) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>        excellent_rank <span class="op">=</span> excellent_ranks[<span class="dv">0</span>]</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>        excellent_error <span class="op">=</span> rel_errors[ranks <span class="op">==</span> excellent_rank][<span class="dv">0</span>]</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   • For &lt; 1% error: Rank </span><span class="sc">{</span>excellent_rank<span class="sc">}</span><span class="ss"> (error: </span><span class="sc">{</span>excellent_error<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">%)"</span>)</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>    tensor_size <span class="op">=</span> np.prod([<span class="dv">13</span>, <span class="dv">10</span>, <span class="dv">5</span>])</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> rank <span class="kw">in</span> [<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>]:</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rank <span class="kw">in</span> ranks:</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>            params <span class="op">=</span> rank <span class="op">*</span> (<span class="dv">13</span> <span class="op">+</span> <span class="dv">10</span> <span class="op">+</span> <span class="dv">5</span>)</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>            compression_ratio <span class="op">=</span> tensor_size <span class="op">/</span> params</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>            error <span class="op">=</span> rel_errors[ranks <span class="op">==</span> rank][<span class="dv">0</span>]</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   • Rank </span><span class="sc">{</span>rank<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>params<span class="sc">}</span><span class="ss"> params, </span><span class="sc">{</span>compression_ratio<span class="sc">:.1f}</span><span class="ss">x compression, </span><span class="sc">{</span>error<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">% error"</span>)</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ranks, rel_errors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rank_analysis(model, save_fig<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Rank analysis showing reconstruction error vs rank</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    ranks <span class="op">=</span> []</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    rel_errors <span class="op">=</span> []</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    abs_errors <span class="op">=</span> []</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> rank, result <span class="kw">in</span> model.items():</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> result <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>            ranks.append(rank)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>            rel_errors.append(result[<span class="st">'rel_error'</span>])</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>            abs_errors.append(result[<span class="st">'error'</span>])</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    ranks <span class="op">=</span> np.array(ranks)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    rel_errors <span class="op">=</span> np.array(rel_errors)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    abs_errors <span class="op">=</span> np.array(abs_errors)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, <span class="dv">0</span>].plot(ranks, rel_errors <span class="op">*</span> <span class="dv">100</span>, <span class="st">'bo-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Rank'</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Relative Error (%)'</span>)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'Reconstruction Error vs Rank'</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, <span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, <span class="dv">0</span>].set_ylim(bottom<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    min_error_idx <span class="op">=</span> np.argmin(rel_errors)</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, <span class="dv">0</span>].annotate(</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'Min: Rank </span><span class="sc">{</span>ranks[min_error_idx]<span class="sc">}</span><span class="ch">\n</span><span class="ss">Error: </span><span class="sc">{</span>rel_errors[min_error_idx]<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%'</span>,</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>      xy<span class="op">=</span>(ranks[min_error_idx], rel_errors[min_error_idx]<span class="op">*</span><span class="dv">100</span>),</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>      xytext<span class="op">=</span>(ranks[min_error_idx]<span class="op">+</span><span class="dv">5</span>, rel_errors[min_error_idx]<span class="op">*</span><span class="dv">100</span><span class="op">+</span><span class="dv">2</span>),</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>      arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">'-&gt;'</span>, color<span class="op">=</span><span class="st">'red'</span>),</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>      fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span><span class="st">'red'</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, <span class="dv">1</span>].semilogy(ranks, rel_errors <span class="op">*</span> <span class="dv">100</span>, <span class="st">'ro-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Rank'</span>)</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Relative Error (%) [Log Scale]'</span>)</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Error vs Rank (Log Scale)'</span>)</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, <span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>    error_reduction <span class="op">=</span> np.diff(rel_errors) <span class="op">/</span> rel_errors[:<span class="op">-</span><span class="dv">1</span>] <span class="op">*</span> <span class="op">-</span><span class="dv">100</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">0</span>].bar(ranks[<span class="dv">1</span>:], error_reduction, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Rank'</span>)</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Error Reduction Rate (%)'</span>)</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Error Improvement Rate (Rank i vs Rank i-1)'</span>)</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>    explained_variance <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> rel_errors<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">1</span>].plot(ranks, explained_variance, <span class="st">'mo-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Rank'</span>)</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Explained Variance (%)'</span>)</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Explained Variance vs Rank'</span>)</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">1</span>].set_ylim([<span class="dv">0</span>, <span class="dv">100</span>])</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> threshold <span class="kw">in</span> [<span class="dv">90</span>, <span class="dv">95</span>, <span class="dv">99</span>]:</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">1</span>].axhline(y<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">1</span>].text(ranks[<span class="op">-</span><span class="dv">10</span>], threshold<span class="op">+</span><span class="dv">1</span>, <span class="ss">f'</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">%'</span>, fontsize<span class="op">=</span><span class="dv">8</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> save_fig:</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>        plt.savefig(<span class="st">'rank_analysis.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig, axes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We obtain four-panel visualization that gives a clear picture of how well different ranks capture tongue shape patterns. The&nbsp;blue curve&nbsp;shows the classic elbow effect: reconstruction error drops quickly between ranks 2–10, then levels off, and finally approaches zero around ranks 40–45. In other words, using more than ~40 ranks lets us reconstruct the data almost perfectly. The&nbsp;log-scale view&nbsp;zooms in on the details, showing that most of the improvement happens early (ranks 2–15), with only small, gradual gains after that. The&nbsp;green bars&nbsp;highlight the “value added” by each rank. Big improvements show up at low ranks (2–10), with a few extra bumps around ranks 20–30. Occasionally, the bars dip below zero, which just means the algorithm stalled briefly due to some numerical hiccups.</p>
<p>From a practical standpoint, choosing a rank between 7–20 is a sweet spot. It captures the meaningful tongue movement patterns without overfitting. Going beyond 40 may look like perfect reconstruction, but in reality, it’s more likely fitting noise than real speech dynamics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>parafac_mod <span class="op">=</span> parafac_modeling(X_tensor, max_rank<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> rank_analysis(model<span class="op">=</span>parafac_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-31-21.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ranks, rel_errors <span class="op">=</span> optimal_rank(model<span class="op">=</span>parafac_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Best overall rank: 50 (error: 0.000%)
 Elbow point: Rank 7 (error: 7.084%)

 Recommendations:
   • For &lt; 5% error: Rank 11 (error: 4.580%)
   • For &lt; 1% error: Rank 24 (error: 0.973%)
   • Rank 5: 140 params, 4.6x compression, 8.91% error
   • Rank 10: 280 params, 2.3x compression, 5.27% error
   • Rank 15: 420 params, 1.5x compression, 2.91% error
   • Rank 20: 560 params, 1.2x compression, 1.90% error</code></pre>
</div>
</div>
</section>
<section id="tucker-decomposition" class="level3">
<h3 class="anchored" data-anchor-id="tucker-decomposition">Tucker decomposition</h3>
<p>For comparison, we also applied Tucker3 decomposition to the tongue shape data. Unlike PARAFAC, where a single rank is chosen for all modes, Tucker3 allows the number of components in each mode to be varied independently. We therefore tested different combinations of model sizes, systematically varying the dimensions of the grid positions, vowels, and speakers modes (e.g., [5, 8, 4] and other configurations).</p>
<p>As in the PARAFAC modeling, each Tucker3 model was fit by decomposing the tensor into three factor matrices and a core tensor. The factor matrices represent the main axes of variation within each mode, while the core tensor captures how these axes interact across grid positions, vowels, and speakers. After reconstruction, the error was computed and stored for each configuration, enabling a direct comparison to PARAFAC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tucker_modeling(X_tensor, max_rank<span class="op">=</span>[<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>]):</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Tucker3 modeling</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">    X_tensor : numpy.ndarray</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Input tensor to decompose</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">    max_rank : list, default=[4, 4, 3]</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Maximum rank for each mode [mode1, mode2, mode3]</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">    dict : Results dictionary with Tucker decomposition results</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    ranks_to_test <span class="op">=</span> []</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r1 <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, max_rank[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> r2 <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, max_rank[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> r3 <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, max_rank[<span class="dv">2</span>] <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>                ranks_to_test.append([r1, r2, r3])</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    successful_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> rank_combo <span class="kw">in</span> ranks_to_test:</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>            factors <span class="op">=</span> tucker(</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>                X_tensor, </span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>                rank<span class="op">=</span>rank_combo,</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>                init<span class="op">=</span><span class="st">'random'</span>, </span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>                n_iter_max<span class="op">=</span><span class="dv">200</span>, </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>                random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>            reconstructed <span class="op">=</span> tl.tucker_to_tensor(factors)</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>            error <span class="op">=</span> tl.norm(X_tensor <span class="op">-</span> reconstructed)</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>            rel_error <span class="op">=</span> error <span class="op">/</span> tl.norm(X_tensor)</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>            core_params <span class="op">=</span> np.prod(rank_combo) </span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>            factor_params <span class="op">=</span> <span class="bu">sum</span>(X_tensor.shape[i] <span class="op">*</span> rank_combo[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>))</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>            total_params <span class="op">=</span> core_params <span class="op">+</span> factor_params</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>            key <span class="op">=</span> <span class="bu">str</span>(rank_combo)</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>            results[key] <span class="op">=</span> {</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>                <span class="st">'ranks'</span>: rank_combo,</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>                <span class="st">'factors'</span>: factors,</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>                <span class="st">'reconstructed'</span>: reconstructed,</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>                <span class="st">'error'</span>: error,</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>                <span class="st">'rel_error'</span>: rel_error,</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">'core_params'</span>: core_params,</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">'factor_params'</span>: factor_params,</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">'total_params'</span>: total_params</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>            successful_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f" Models failed - </span><span class="sc">{</span><span class="bu">str</span>(e)[:<span class="dv">30</span>]<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>            results[<span class="bu">str</span>(rank_combo)] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tucker_results(model):</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Analyze Tucker decomposition results"""</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    successful_results <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> model.items() <span class="cf">if</span> v <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>}</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> successful_results:</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">" No successful Tucker decompositions to analyze"</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    best_key <span class="op">=</span> <span class="bu">min</span>(successful_results.keys(), key<span class="op">=</span><span class="kw">lambda</span> k:</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>      successful_results[k][<span class="st">'rel_error'</span>])</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    best_result <span class="op">=</span> successful_results[best_key]</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f" Best configuration: </span><span class="sc">{</span>best_result[<span class="st">'ranks'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Relative error: </span><span class="sc">{</span>best_result[<span class="st">'rel_error'</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">%"</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Total parameters: </span><span class="sc">{</span>best_result[<span class="st">'total_params'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Core parameters: </span><span class="sc">{</span>best_result[<span class="st">'core_params'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Factor parameters: </span><span class="sc">{</span>best_result[<span class="st">'factor_params'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss"> Top 5 configurations:"</span>)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    sorted_results <span class="op">=</span> <span class="bu">sorted</span>(successful_results.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>][<span class="st">'rel_error'</span>])</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (key, result) <span class="kw">in</span> <span class="bu">enumerate</span>(sorted_results[:<span class="dv">5</span>]):</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>        compression_ratio <span class="op">=</span> np.prod(tensor_dims) <span class="op">/</span> result[<span class="st">'total_params'</span>]</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"   </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>result[<span class="st">'ranks'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>result[<span class="st">'rel_error'</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">% error, "</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>result[<span class="st">'total_params'</span>]<span class="sc">}</span><span class="ss"> params, </span><span class="sc">{</span>compression_ratio<span class="sc">:.1f}</span><span class="ss">x compression"</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss"> Recommendations:"</span>)</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> threshold <span class="kw">in</span> [<span class="fl">0.05</span>, <span class="fl">0.01</span>, <span class="fl">0.005</span>]:</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>        good_configs <span class="op">=</span> [(k, v) <span class="cf">for</span> k, v <span class="kw">in</span> successful_results.items() </span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">if</span> v[<span class="st">'rel_error'</span>] <span class="op">&lt;</span> threshold]</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> good_configs:</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>            best_config <span class="op">=</span> <span class="bu">min</span>(good_configs, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>][<span class="st">'total_params'</span>])</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> best_config[<span class="dv">1</span>]</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"   • For &lt;</span><span class="sc">{</span>threshold<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">% error: </span><span class="sc">{</span>result[<span class="st">'ranks'</span>]<span class="sc">}</span><span class="ss"> "</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"(</span><span class="sc">{</span>result[<span class="st">'rel_error'</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">% error, </span><span class="sc">{</span>result[<span class="st">'total_params'</span>]<span class="sc">}</span><span class="ss"> params)"</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>              )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_tucker_results(model):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create comprehensive Tucker visualization"""</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    successful_results <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> model.items() <span class="cf">if</span> v <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>}</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> successful_results:</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">" No successful decompositions to plot"</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    configs <span class="op">=</span> []</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    rel_errors <span class="op">=</span> []</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    total_params <span class="op">=</span> []</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    core_params <span class="op">=</span> []</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    factor_params <span class="op">=</span> []</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    compression_ratios <span class="op">=</span> []</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    tensor_size <span class="op">=</span> tensor_dims[<span class="dv">0</span>] <span class="op">*</span> tensor_dims[<span class="dv">1</span>] <span class="op">*</span> tensor_dims[<span class="dv">2</span>]</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key, result <span class="kw">in</span> successful_results.items():</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>        configs.append(key)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>        rel_errors.append(result[<span class="st">'rel_error'</span>] <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>        total_params.append(result[<span class="st">'total_params'</span>])</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>        core_params.append(result[<span class="st">'core_params'</span>])</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>        factor_params.append(result[<span class="st">'factor_params'</span>])</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>        compression_ratios.append(tensor_size <span class="op">/</span> result[<span class="st">'total_params'</span>])</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    rel_errors <span class="op">=</span> np.array(rel_errors)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>    total_params <span class="op">=</span> np.array(total_params)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    compression_ratios <span class="op">=</span> np.array(compression_ratios)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">12</span>))</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>    sorted_indices <span class="op">=</span> np.argsort(rel_errors)</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    top_20 <span class="op">=</span> sorted_indices[:<span class="bu">min</span>(<span class="dv">20</span>, <span class="bu">len</span>(sorted_indices))]</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> plt.bar(<span class="bu">range</span>(<span class="bu">len</span>(top_20)), rel_errors[top_20], alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'skyblue'</span>)</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Configuration Rank'</span>)</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Relative Error (%)'</span>)</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Tucker: Top 20 Configurations by Error'</span>)</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>    plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(top_20)), [configs[i] <span class="cf">for</span> i <span class="kw">in</span> top_20], rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(top_20) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>        bars[<span class="dv">0</span>].set_color(<span class="st">'gold'</span>)</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="dv">0</span>, rel_errors[top_20[<span class="dv">0</span>]] <span class="op">+</span> <span class="fl">0.1</span>, <span class="st">'Best'</span>, ha<span class="op">=</span><span class="st">'center'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>    scatter <span class="op">=</span> plt.scatter(total_params, rel_errors, c<span class="op">=</span>compression_ratios, </span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>                         cmap<span class="op">=</span><span class="st">'viridis'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, s<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Total Parameters'</span>)</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Relative Error (%)'</span>)</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Tucker: Error vs Model Complexity'</span>)</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>    cbar <span class="op">=</span> plt.colorbar(scatter)</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>    cbar.set_label(<span class="st">'Compression Ratio'</span>)</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>    pareto_indices <span class="op">=</span> _find_pareto_front(total_params, rel_errors)</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>    plt.plot(</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>      total_params[pareto_indices], </span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>      rel_errors[pareto_indices], </span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>      <span class="st">'r-'</span>, </span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>      linewidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>      alpha<span class="op">=</span><span class="fl">0.8</span>, </span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>      label<span class="op">=</span><span class="st">'Pareto Front'</span></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>    top_10_by_error <span class="op">=</span> sorted_indices[:<span class="dv">10</span>]</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>    core_params_top <span class="op">=</span> [core_params[i] <span class="cf">for</span> i <span class="kw">in</span> top_10_by_error]</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>    factor_params_top <span class="op">=</span> [factor_params[i] <span class="cf">for</span> i <span class="kw">in</span> top_10_by_error]</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>    configs_top <span class="op">=</span> [configs[i] <span class="cf">for</span> i <span class="kw">in</span> top_10_by_error]</span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a>    x_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(top_10_by_error))</span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> plt.bar(</span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>      x_pos, </span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>      core_params_top, </span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>      alpha<span class="op">=</span><span class="fl">0.8</span>, </span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>      color<span class="op">=</span><span class="st">'coral'</span>, </span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a>      label<span class="op">=</span><span class="st">'Core Parameters'</span></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> plt.bar(</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a>      x_pos, </span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a>      factor_params_top, </span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>      bottom<span class="op">=</span>core_params_top, </span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a>      alpha<span class="op">=</span><span class="fl">0.8</span>, </span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a>      color<span class="op">=</span><span class="st">'lightblue'</span>, </span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>      label<span class="op">=</span><span class="st">'Factor Parameters'</span></span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Configuration'</span>)</span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Number of Parameters'</span>)</span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Tucker: Parameter Breakdown (Top 10)'</span>)</span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a>    plt.xticks(x_pos, configs_top, rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a>    ax4 <span class="op">=</span> plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a>    plt.scatter(compression_ratios, rel_errors, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'green'</span>, s<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Compression Ratio'</span>)</span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Relative Error (%)'</span>)</span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Tucker: Compression vs Accuracy Trade-off'</span>)</span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a>    high_compression <span class="op">=</span> compression_ratios <span class="op">&gt;</span> <span class="fl">1.0</span></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">any</span>(high_compression):</span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>        best_compression_idx <span class="op">=</span> np.argmax(compression_ratios[high_compression])</span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a>        best_idx <span class="op">=</span> np.where(high_compression)[<span class="dv">0</span>][best_compression_idx]</span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a>        plt.annotate(</span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f'</span><span class="sc">{</span>configs[best_idx]<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span>compression_ratios[best_idx]<span class="sc">:.1f}</span><span class="ss">x'</span>,</span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a>          xy<span class="op">=</span>(compression_ratios[best_idx], rel_errors[best_idx]),</span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a>          xytext<span class="op">=</span>(compression_ratios[best_idx]<span class="op">+</span><span class="fl">0.1</span>, rel_errors[best_idx]<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a>          arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">'-&gt;'</span>, color<span class="op">=</span><span class="st">'red'</span>),</span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">9</span>, </span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a>          color<span class="op">=</span><span class="st">'red'</span></span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a>    ax5 <span class="op">=</span> plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a>    plt.hist(rel_errors, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'purple'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Relative Error (%)'</span>)</span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Tucker: Error Distribution'</span>)</span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>    plt.axvline(</span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a>      np.mean(rel_errors), </span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a>      color<span class="op">=</span><span class="st">'red'</span>, </span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a>      linestyle<span class="op">=</span><span class="st">'--'</span>, </span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a>      label<span class="op">=</span><span class="ss">f'Mean: </span><span class="sc">{</span>np<span class="sc">.</span>mean(rel_errors)<span class="sc">:.2f}</span><span class="ss">%'</span></span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a>    plt.axvline(</span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a>      np.median(rel_errors), </span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a>      color<span class="op">=</span><span class="st">'orange'</span>, </span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a>      linestyle<span class="op">=</span><span class="st">'--'</span>, </span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a>      label<span class="op">=</span><span class="ss">f'Median: </span><span class="sc">{</span>np<span class="sc">.</span>median(rel_errors)<span class="sc">:.2f}</span><span class="ss">%'</span></span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a>    ax6 <span class="op">=</span> plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>)</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(successful_results) <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a>        rank_data <span class="op">=</span> []</span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> key, result <span class="kw">in</span> successful_results.items():</span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a>            r1, r2, r3 <span class="op">=</span> result[<span class="st">'ranks'</span>]</span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a>            rank_data.append([r1, r2, r3, result[<span class="st">'rel_error'</span>]])</span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a>        rank_data <span class="op">=</span> np.array(rank_data)</span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a>        unique_r1 <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">set</span>(rank_data[:, <span class="dv">0</span>]))</span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a>        unique_r2 <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">set</span>(rank_data[:, <span class="dv">1</span>]))</span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(unique_r1) <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> <span class="bu">len</span>(unique_r2) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a>            heatmap_data <span class="op">=</span> np.full((<span class="bu">len</span>(unique_r2), <span class="bu">len</span>(unique_r1)), np.nan)</span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, r2 <span class="kw">in</span> <span class="bu">enumerate</span>(unique_r2):</span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j, r1 <span class="kw">in</span> <span class="bu">enumerate</span>(unique_r1):</span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a>                    mask <span class="op">=</span> (rank_data[:, <span class="dv">0</span>] <span class="op">==</span> r1) <span class="op">&amp;</span> (rank_data[:, <span class="dv">1</span>] <span class="op">==</span> r2)</span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> np.<span class="bu">any</span>(mask):</span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a>                        heatmap_data[i, j] <span class="op">=</span> np.<span class="bu">min</span>(rank_data[mask, <span class="dv">3</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a>            im <span class="op">=</span> plt.imshow(heatmap_data, cmap<span class="op">=</span><span class="st">'RdYlBu_r'</span>, aspect<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a>            plt.colorbar(im, label<span class="op">=</span><span class="st">'Relative Error (%)'</span>)</span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'Mode 1 Rank'</span>)</span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Mode 2 Rank'</span>)</span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="st">'Tucker: Error Heatmap (Mode 1 vs Mode 2)'</span>)</span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a>            plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(unique_r1)), unique_r1)</span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a>            plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(unique_r2)), unique_r2)</span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a>            plt.text(</span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a>              <span class="fl">0.5</span>, </span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a>              <span class="fl">0.5</span>, </span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Insufficient data</span><span class="ch">\n</span><span class="st">for heatmap'</span>, </span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a>               ha<span class="op">=</span><span class="st">'center'</span>, </span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>               va<span class="op">=</span><span class="st">'center'</span>, </span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a>               transform<span class="op">=</span>ax6.transAxes, fontsize<span class="op">=</span><span class="dv">12</span></span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a>        plt.text(</span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a>          <span class="fl">0.5</span>, </span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a>          <span class="fl">0.5</span>, </span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Too few configurations</span><span class="ch">\n</span><span class="st">for heatmap'</span>, </span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a>          ha<span class="op">=</span><span class="st">'center'</span>, </span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a>          va<span class="op">=</span><span class="st">'center'</span>, </span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a>          transform<span class="op">=</span>ax6.transAxes, </span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">12</span></span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="st">'Tucker Decomposition Analysis'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, y<span class="op">=</span><span class="fl">0.98</span>)</span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _find_pareto_front(params, errors):</span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find Pareto front for parameter-error trade-off"""</span></span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a>    sorted_indices <span class="op">=</span> np.argsort(params)</span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a>    pareto_indices <span class="op">=</span> []</span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a>    min_error_so_far <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx <span class="kw">in</span> sorted_indices:</span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> errors[idx] <span class="op">&lt;</span> min_error_so_far:</span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a>            pareto_indices.append(idx)</span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a>            min_error_so_far <span class="op">=</span> errors[idx]</span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(pareto_indices)</span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Analyze Tucker decomposition results"""</span></span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a>    successful_results <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> results.items() <span class="cf">if</span> v <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>}</span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> successful_results:</span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">" No successful Tucker decompositions to analyze"</span>)</span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a>    best_key <span class="op">=</span> <span class="bu">min</span>(successful_results.keys(), key<span class="op">=</span><span class="kw">lambda</span> k:</span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a>      successful_results[k][<span class="st">'rel_error'</span>])</span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a>    best_result <span class="op">=</span> successful_results[best_key]</span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f" Best configuration: </span><span class="sc">{</span>best_result[<span class="st">'ranks'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Relative error: </span><span class="sc">{</span>best_result[<span class="st">'rel_error'</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">%"</span>)</span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Total parameters: </span><span class="sc">{</span>best_result[<span class="st">'total_params'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Core parameters: </span><span class="sc">{</span>best_result[<span class="st">'core_params'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Factor parameters: </span><span class="sc">{</span>best_result[<span class="st">'factor_params'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss"> Top 5 configurations:"</span>)</span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a>    sorted_results <span class="op">=</span> <span class="bu">sorted</span>(successful_results.items(), key<span class="op">=</span><span class="kw">lambda</span> x:</span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a>      x[<span class="dv">1</span>][<span class="st">'rel_error'</span>])</span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (key, result) <span class="kw">in</span> <span class="bu">enumerate</span>(sorted_results[:<span class="dv">5</span>]):</span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a>        compression_ratio <span class="op">=</span> np.prod(tensor_dims) <span class="op">/</span> result[<span class="st">'total_params'</span>]</span>
<span id="cb35-227"><a href="#cb35-227" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(</span>
<span id="cb35-228"><a href="#cb35-228" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"   </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>result[<span class="st">'ranks'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>result[<span class="st">'rel_error'</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">% error, "</span></span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"</span><span class="sc">{</span>result[<span class="st">'total_params'</span>]<span class="sc">}</span><span class="ss"> params, </span><span class="sc">{</span>compression_ratio<span class="sc">:.1f}</span><span class="ss">x compression"</span></span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss"> Recommendations:"</span>)</span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> threshold <span class="kw">in</span> [<span class="fl">0.05</span>, <span class="fl">0.01</span>, <span class="fl">0.005</span>]:</span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a>        good_configs <span class="op">=</span> [(k, v) <span class="cf">for</span> k, v <span class="kw">in</span> successful_results.items() </span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">if</span> v[<span class="st">'rel_error'</span>] <span class="op">&lt;</span> threshold]</span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> good_configs:</span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a>            best_config <span class="op">=</span> <span class="bu">min</span>(good_configs, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>][<span class="st">'total_params'</span>])</span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> best_config[<span class="dv">1</span>]</span>
<span id="cb35-239"><a href="#cb35-239" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(</span>
<span id="cb35-240"><a href="#cb35-240" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"   • For &lt;</span><span class="sc">{</span>threshold<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">% error: </span><span class="sc">{</span>result[<span class="st">'ranks'</span>]<span class="sc">}</span><span class="ss"> "</span></span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"(</span><span class="sc">{</span>result[<span class="st">'rel_error'</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">% error, </span><span class="sc">{</span>result[<span class="st">'total_params'</span>]<span class="sc">}</span><span class="ss"> params)"</span></span>
<span id="cb35-242"><a href="#cb35-242" aria-hidden="true" tabindex="-1"></a>              )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Likewise, the six-panel visualization below provides insights into Tucker decomposition performance across different core tensor configurations.</p>
<p>The top-left panel showcases the twenty best-performing configurations, with reconstruction errors clustered impressively between 0.5-2.0%. This immediately tells us that Tucker decomposition can achieve excellent accuracy for our tongue shape data when properly configured. The scatter plot of error versus model complexity illustrates the trade-off between accuracy and efficiency. The red Pareto Front marks the “optimal” configurations, where we cannot improve both accuracy and efficiency at the same time. In other words, if we want a lower error, we must accept higher complexity, and vice versa.</p>
<p>The stacked bars break down model complexity into two parts: parameters from the core tensor (orange) and those from the factor matrices (blue). This shows where the computational cost comes from in each model. The green dots compare compression ratio against reconstruction error. Configurations above the diagonal line achieve good compression while still keeping the error low, which makes them especially useful in practice.</p>
<p>Finally, the histogram shows the overall distribution of errors. Most Tucker configurations fall between 8–10% error, with a median of 8.7% and a mean of 9.2%. A few standout models perform much better, achieving far lower error rates. The color-coded grid provides another view, showing how reconstruction error changes across rank combinations for the first two modes. This makes it easier to detect “sweet spots” where the model balances accuracy and efficiency most effectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>tucker_mod <span class="op">=</span> tucker_modeling(X_tensor)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>plot_tucker_results(model <span class="op">=</span> tucker_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-36-23.png" class="img-fluid figure-img" width="1728"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>tucker_results(model <span class="op">=</span> tucker_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Best configuration: [10, 10, 10]
   - Relative error: 1.348%
   - Total parameters: 1280
   - Core parameters: 1000
   - Factor parameters: 280

 Top 5 configurations:
   1. [10, 10, 10]: 1.348% error, 1280 params, 0.5x compression
   2. [10, 10, 9]: 1.348% error, 1175 params, 0.6x compression
   3. [10, 10, 8]: 1.348% error, 1070 params, 0.6x compression
   4. [10, 10, 5]: 1.348% error, 755 params, 0.9x compression
   5. [10, 10, 6]: 1.348% error, 860 params, 0.8x compression

 Recommendations:
   • For &lt;5.0% error: [5, 9, 5] (4.703% error, 405 params)</code></pre>
</div>
</div>
</section>
<section id="model-comparison" class="level3">
<h3 class="anchored" data-anchor-id="model-comparison">Model Comparison</h3>
<p>After optimizing both decomposition methods, we can now directly compare their performance on our tongue shape data. The comparison reveals distinct characteristics and trade-offs between the two approaches.</p>
<p>The original tensor slices in the top row provide our baseline reference, showing the complex spatial patterns of tongue positions across different speakers and vowels. Both PARAFAC and Tucker successfully capture the general structure of these patterns, but with notable differences in their approach and results.</p>
<p>PARAFAC, configured with rank 7, demonstrates its signature strength in providing interpretable factor loadings across all three modes. The factor plots show clear, distinct patterns for each component, with the grid position factors revealing systematic spatial relationships and the vowel factors capturing acoustic-articulatory connections. The reconstruction achieves a 7.08% relative error with just 196 parameters, making it remarkably parameter-efficient. The error map shows relatively uniform reconstruction quality across the tensor space. Meanwhile, Tucker decomposition, using core dimensions [5, 9, 5], takes a fundamentally different approach with its more flexible structure. The factor matrices show more complex patterns, reflecting Tucker’s ability to capture asymmetric relationships between modes. With 405 parameters, Tucker achieves a superior 4.70% relative error, demonstrating the power of its additional flexibility. The core tensor visualization shows the internal structure that Tucker uses to combine these factors, something absent in PARAFAC’s simpler multiplicative model.</p>
<p>The direct comparison panels at the bottom quantify these trade-offs clearly. PARAFAC wins on parameter efficiency with 196 versus 405 parameters, translating to better compression ratios. However, Tucker delivers superior reconstruction accuracy with nearly 30% lower relative error. The reconstruction difference heatmap highlights where these methods disagree most strongly, typically in regions with complex multimodal interactions.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compare_optimized_models(X_tensor, parafac_rank, tucker_ranks):</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compare optimized PARAFAC and Tucker models with comprehensive analysis</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">    X_tensor : numpy.ndarray</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Input tensor to decompose</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">    parafac_rank : int</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Optimal rank for PARAFAC</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">    tucker_ranks : list</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Optimal ranks for Tucker [mode1, mode2, mode3]</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PARAFAC Decomposition</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>        parafac_factors <span class="op">=</span> parafac(</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>            X_tensor, </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>            rank<span class="op">=</span>parafac_rank, </span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>            init<span class="op">=</span><span class="st">'random'</span>, </span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>            n_iter_max<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>            random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>        X_parafac_reconstructed <span class="op">=</span> tl.cp_to_tensor(parafac_factors)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>        parafac_error <span class="op">=</span> tl.norm(X_tensor <span class="op">-</span> X_parafac_reconstructed)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>        parafac_rel_error <span class="op">=</span> parafac_error <span class="op">/</span> tl.norm(X_tensor)</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>        parafac_params <span class="op">=</span> parafac_rank <span class="op">*</span> <span class="bu">sum</span>(X_tensor.shape)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>        results[<span class="st">'PARAFAC'</span>] <span class="op">=</span> {</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">'success'</span>: <span class="va">True</span>,</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'factors'</span>: parafac_factors,</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'reconstructed'</span>: X_parafac_reconstructed,</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">'error'</span>: parafac_error,</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'rel_error'</span>: parafac_rel_error,</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">'rank'</span>: parafac_rank,</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">'params'</span>: parafac_params,</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">'method'</span>: <span class="st">'PARAFAC'</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>        results[<span class="st">'PARAFAC'</span>] <span class="op">=</span> {<span class="st">'success'</span>: <span class="va">False</span>, <span class="st">'error'</span>: <span class="bu">str</span>(e)}</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tucker Decomposition</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>        tucker_factors <span class="op">=</span> tucker(</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>            X_tensor, </span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>            rank<span class="op">=</span>tucker_ranks, </span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>            init<span class="op">=</span><span class="st">'random'</span>,</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>            n_iter_max<span class="op">=</span><span class="dv">200</span>, </span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>            random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>        X_tucker_reconstructed <span class="op">=</span> tl.tucker_to_tensor(tucker_factors)</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>        tucker_error <span class="op">=</span> tl.norm(X_tensor <span class="op">-</span> X_tucker_reconstructed)</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>        tucker_rel_error <span class="op">=</span> tucker_error <span class="op">/</span> tl.norm(X_tensor)</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>        core_params <span class="op">=</span> np.prod(tucker_ranks)</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>        factor_params <span class="op">=</span> <span class="bu">sum</span>(X_tensor.shape[i] <span class="op">*</span> tucker_ranks[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>))</span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>        tucker_params <span class="op">=</span> core_params <span class="op">+</span> factor_params</span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>        results[<span class="st">'Tucker'</span>] <span class="op">=</span> {</span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">'success'</span>: <span class="va">True</span>,</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>            <span class="st">'factors'</span>: tucker_factors,</span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>            <span class="st">'reconstructed'</span>: X_tucker_reconstructed,</span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>            <span class="st">'error'</span>: tucker_error,</span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>            <span class="st">'rel_error'</span>: tucker_rel_error,</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ranks'</span>: tucker_ranks,</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">'params'</span>: tucker_params,</span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>            <span class="st">'core_params'</span>: core_params,</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">'factor_params'</span>: factor_params,</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>            <span class="st">'method'</span>: <span class="st">'Tucker'</span></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>        results[<span class="st">'Tucker'</span>] <span class="op">=</span> {<span class="st">'success'</span>: <span class="va">False</span>, <span class="st">'error'</span>: <span class="bu">str</span>(e)}</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>    _visualization(results, X_tensor)</span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>    _summary(results)</span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _visualization(results, X_tensor):</span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create comprehensive comparison visualization"""</span></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a>    successful_methods <span class="op">=</span> [method <span class="cf">for</span> method, result <span class="kw">in</span> results.items() <span class="cf">if</span> result[<span class="st">'success'</span>]]</span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> successful_methods:</span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">14</span>))</span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Original tensor slices</span></span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(<span class="dv">5</span>, X_tensor.shape[<span class="dv">2</span>])):</span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, i<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> plt.imshow(X_tensor[:, :, i], cmap<span class="op">=</span><span class="st">'viridis'</span>, aspect<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="ss">f'Original Tensor</span><span class="ch">\n</span><span class="ss">Slice </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a>        plt.colorbar(im, shrink<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Mode 1'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Mode 2'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tensor statistics</span></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">6</span>)</span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>    ax.text(<span class="fl">0.1</span>, <span class="fl">0.8</span>, <span class="ss">f'Shape: </span><span class="sc">{</span>X_tensor<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a>    ax.text(<span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="ss">f'Elements: </span><span class="sc">{</span>np<span class="sc">.</span>prod(X_tensor.shape)<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>    ax.text(<span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="ss">f'Norm: </span><span class="sc">{</span>tl<span class="sc">.</span>norm(X_tensor)<span class="sc">:.3f}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a>    ax.text(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="ss">f'Range: [</span><span class="sc">{</span>X_tensor<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>X_tensor<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.3f}</span><span class="ss">]'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Tensor Stats'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>    ax.axis(<span class="st">'off'</span>)</span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PARAFAC Analysis</span></span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'PARAFAC'</span> <span class="kw">in</span> successful_methods:</span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> results[<span class="st">'PARAFAC'</span>]</span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a>        factors <span class="op">=</span> result[<span class="st">'factors'</span>][<span class="dv">1</span>]</span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> [<span class="st">'blue'</span>, <span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'orange'</span>]</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a>        <span class="co"># PARAFAC factor matrices</span></span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> mode <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">7</span> <span class="op">+</span> mode)</span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a>            n_comps_show <span class="op">=</span> <span class="bu">min</span>(<span class="dv">4</span>, factors[mode].shape[<span class="dv">1</span>])</span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> comp <span class="kw">in</span> <span class="bu">range</span>(n_comps_show):</span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a>                plt.plot(factors[mode][:, comp], color<span class="op">=</span>colors[comp], </span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'Comp </span><span class="sc">{</span>comp<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, marker<span class="op">=</span><span class="st">'o'</span>, markersize<span class="op">=</span><span class="dv">3</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="ss">f'PARAFAC Mode </span><span class="sc">{</span>mode<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'Index'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Factor Value'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> mode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a>                plt.legend(fontsize<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a>        <span class="co"># PARAFAC reconstruction</span></span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">10</span>)</span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a>        recon_slice <span class="op">=</span> result[<span class="st">'reconstructed'</span>][:, :, <span class="dv">0</span>]</span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> plt.imshow(recon_slice, cmap<span class="op">=</span><span class="st">'viridis'</span>, aspect<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="ss">f'PARAFAC Recon'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a>        plt.colorbar(im, shrink<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a>        <span class="co"># PARAFAC error</span></span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">11</span>)</span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a>        error_slice <span class="op">=</span> np.<span class="bu">abs</span>(X_tensor[:, :, <span class="dv">0</span>] <span class="op">-</span> recon_slice)</span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> plt.imshow(error_slice, cmap<span class="op">=</span><span class="st">'Reds'</span>, aspect<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="ss">f'PARAFAC Error'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a>        plt.colorbar(im, shrink<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a>        <span class="co"># PARAFAC stats</span></span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">12</span>)</span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a>        ax.text(<span class="fl">0.1</span>, <span class="fl">0.8</span>, <span class="ss">f"Rank: </span><span class="sc">{</span>result[<span class="st">'rank'</span>]<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a>        ax.text(<span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="ss">f"Error: </span><span class="sc">{</span>result[<span class="st">'rel_error'</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">%"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a>        ax.text(<span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="ss">f"Params: </span><span class="sc">{</span>result[<span class="st">'params'</span>]<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a>        compression <span class="op">=</span> np.prod(X_tensor.shape) <span class="op">/</span> result[<span class="st">'params'</span>]</span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a>        ax.text(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="ss">f"Compression: </span><span class="sc">{</span>compression<span class="sc">:.2f}</span><span class="ss">x"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">'PARAFAC Stats'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a>        ax.axis(<span class="st">'off'</span>)</span>
<span id="cb39-155"><a href="#cb39-155" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-156"><a href="#cb39-156" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tucker Analysis</span></span>
<span id="cb39-157"><a href="#cb39-157" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'Tucker'</span> <span class="kw">in</span> successful_methods:</span>
<span id="cb39-158"><a href="#cb39-158" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> results[<span class="st">'Tucker'</span>]</span>
<span id="cb39-159"><a href="#cb39-159" aria-hidden="true" tabindex="-1"></a>        factors <span class="op">=</span> result[<span class="st">'factors'</span>][<span class="dv">1</span>]</span>
<span id="cb39-160"><a href="#cb39-160" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-161"><a href="#cb39-161" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Tucker factor matrices</span></span>
<span id="cb39-162"><a href="#cb39-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> mode <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb39-163"><a href="#cb39-163" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">13</span> <span class="op">+</span> mode)</span>
<span id="cb39-164"><a href="#cb39-164" aria-hidden="true" tabindex="-1"></a>            n_comps_show <span class="op">=</span> <span class="bu">min</span>(<span class="dv">4</span>, factors[mode].shape[<span class="dv">1</span>])</span>
<span id="cb39-165"><a href="#cb39-165" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> comp <span class="kw">in</span> <span class="bu">range</span>(n_comps_show):</span>
<span id="cb39-166"><a href="#cb39-166" aria-hidden="true" tabindex="-1"></a>                plt.plot(factors[mode][:, comp], color<span class="op">=</span>colors[comp], </span>
<span id="cb39-167"><a href="#cb39-167" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'Comp </span><span class="sc">{</span>comp<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, marker<span class="op">=</span><span class="st">'s'</span>, markersize<span class="op">=</span><span class="dv">3</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb39-168"><a href="#cb39-168" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="ss">f'Tucker Mode </span><span class="sc">{</span>mode<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-169"><a href="#cb39-169" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'Index'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb39-170"><a href="#cb39-170" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Factor Value'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb39-171"><a href="#cb39-171" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> mode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb39-172"><a href="#cb39-172" aria-hidden="true" tabindex="-1"></a>                plt.legend(fontsize<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb39-173"><a href="#cb39-173" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb39-174"><a href="#cb39-174" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-175"><a href="#cb39-175" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Tucker core tensor</span></span>
<span id="cb39-176"><a href="#cb39-176" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">16</span>)</span>
<span id="cb39-177"><a href="#cb39-177" aria-hidden="true" tabindex="-1"></a>        core <span class="op">=</span> result[<span class="st">'factors'</span>][<span class="dv">0</span>]</span>
<span id="cb39-178"><a href="#cb39-178" aria-hidden="true" tabindex="-1"></a>        core_slice <span class="op">=</span> core[:, :, <span class="dv">0</span>] <span class="cf">if</span> core.ndim <span class="op">==</span> <span class="dv">3</span> <span class="cf">else</span> core</span>
<span id="cb39-179"><a href="#cb39-179" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> plt.imshow(core_slice, cmap<span class="op">=</span><span class="st">'RdBu_r'</span>, aspect<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb39-180"><a href="#cb39-180" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Tucker Core'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-181"><a href="#cb39-181" aria-hidden="true" tabindex="-1"></a>        plt.colorbar(im, shrink<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb39-182"><a href="#cb39-182" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-183"><a href="#cb39-183" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Tucker reconstruction</span></span>
<span id="cb39-184"><a href="#cb39-184" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">17</span>)</span>
<span id="cb39-185"><a href="#cb39-185" aria-hidden="true" tabindex="-1"></a>        recon_slice <span class="op">=</span> result[<span class="st">'reconstructed'</span>][:, :, <span class="dv">0</span>]</span>
<span id="cb39-186"><a href="#cb39-186" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> plt.imshow(recon_slice, cmap<span class="op">=</span><span class="st">'viridis'</span>, aspect<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb39-187"><a href="#cb39-187" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="ss">f'Tucker Recon'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-188"><a href="#cb39-188" aria-hidden="true" tabindex="-1"></a>        plt.colorbar(im, shrink<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb39-189"><a href="#cb39-189" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-190"><a href="#cb39-190" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Tucker stats</span></span>
<span id="cb39-191"><a href="#cb39-191" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">18</span>)</span>
<span id="cb39-192"><a href="#cb39-192" aria-hidden="true" tabindex="-1"></a>        ax.text(<span class="fl">0.1</span>, <span class="fl">0.8</span>, <span class="ss">f"Ranks: </span><span class="sc">{</span>result[<span class="st">'ranks'</span>]<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb39-193"><a href="#cb39-193" aria-hidden="true" tabindex="-1"></a>        ax.text(<span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="ss">f"Error: </span><span class="sc">{</span>result[<span class="st">'rel_error'</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">%"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb39-194"><a href="#cb39-194" aria-hidden="true" tabindex="-1"></a>        ax.text(<span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="ss">f"Params: </span><span class="sc">{</span>result[<span class="st">'params'</span>]<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb39-195"><a href="#cb39-195" aria-hidden="true" tabindex="-1"></a>        compression <span class="op">=</span> np.prod(X_tensor.shape) <span class="op">/</span> result[<span class="st">'params'</span>]</span>
<span id="cb39-196"><a href="#cb39-196" aria-hidden="true" tabindex="-1"></a>        ax.text(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="ss">f"Compression: </span><span class="sc">{</span>compression<span class="sc">:.2f}</span><span class="ss">x"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb39-197"><a href="#cb39-197" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">'Tucker Stats'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-198"><a href="#cb39-198" aria-hidden="true" tabindex="-1"></a>        ax.axis(<span class="st">'off'</span>)</span>
<span id="cb39-199"><a href="#cb39-199" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-200"><a href="#cb39-200" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Direct Comparison</span></span>
<span id="cb39-201"><a href="#cb39-201" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(successful_methods) <span class="op">&gt;=</span> <span class="dv">2</span>:</span>
<span id="cb39-202"><a href="#cb39-202" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Error comparison</span></span>
<span id="cb39-203"><a href="#cb39-203" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">19</span>)</span>
<span id="cb39-204"><a href="#cb39-204" aria-hidden="true" tabindex="-1"></a>        methods <span class="op">=</span> [result[<span class="st">'method'</span>] <span class="cf">for</span> result <span class="kw">in</span> results.values() <span class="cf">if</span> result[<span class="st">'success'</span>]]</span>
<span id="cb39-205"><a href="#cb39-205" aria-hidden="true" tabindex="-1"></a>        errors <span class="op">=</span> [result[<span class="st">'rel_error'</span>] <span class="cf">for</span> result <span class="kw">in</span> results.values() <span class="cf">if</span> result[<span class="st">'success'</span>]]</span>
<span id="cb39-206"><a href="#cb39-206" aria-hidden="true" tabindex="-1"></a>        colors_comp <span class="op">=</span> [<span class="st">'skyblue'</span>, <span class="st">'lightcoral'</span>][:<span class="bu">len</span>(methods)]</span>
<span id="cb39-207"><a href="#cb39-207" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-208"><a href="#cb39-208" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> plt.bar(methods, errors, color<span class="op">=</span>colors_comp, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb39-209"><a href="#cb39-209" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Error Comparison'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-210"><a href="#cb39-210" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Relative Error'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb39-211"><a href="#cb39-211" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb39-212"><a href="#cb39-212" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-213"><a href="#cb39-213" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bar, error <span class="kw">in</span> <span class="bu">zip</span>(bars, errors):</span>
<span id="cb39-214"><a href="#cb39-214" aria-hidden="true" tabindex="-1"></a>            plt.text(</span>
<span id="cb39-215"><a href="#cb39-215" aria-hidden="true" tabindex="-1"></a>                bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb39-216"><a href="#cb39-216" aria-hidden="true" tabindex="-1"></a>                bar.get_height() <span class="op">+</span> <span class="fl">0.002</span>,</span>
<span id="cb39-217"><a href="#cb39-217" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>error<span class="sc">:.4f}</span><span class="ss">'</span>, </span>
<span id="cb39-218"><a href="#cb39-218" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, </span>
<span id="cb39-219"><a href="#cb39-219" aria-hidden="true" tabindex="-1"></a>                va<span class="op">=</span><span class="st">'bottom'</span>, </span>
<span id="cb39-220"><a href="#cb39-220" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">8</span></span>
<span id="cb39-221"><a href="#cb39-221" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb39-222"><a href="#cb39-222" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-223"><a href="#cb39-223" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Parameter comparison</span></span>
<span id="cb39-224"><a href="#cb39-224" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">20</span>)</span>
<span id="cb39-225"><a href="#cb39-225" aria-hidden="true" tabindex="-1"></a>        params <span class="op">=</span> [result[<span class="st">'params'</span>] <span class="cf">for</span> result <span class="kw">in</span> results.values() <span class="cf">if</span> result[<span class="st">'success'</span>]]</span>
<span id="cb39-226"><a href="#cb39-226" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> plt.bar(methods, params, color<span class="op">=</span>colors_comp, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb39-227"><a href="#cb39-227" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Parameters'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-228"><a href="#cb39-228" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'# Parameters'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb39-229"><a href="#cb39-229" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb39-230"><a href="#cb39-230" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-231"><a href="#cb39-231" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bar, param <span class="kw">in</span> <span class="bu">zip</span>(bars, params):</span>
<span id="cb39-232"><a href="#cb39-232" aria-hidden="true" tabindex="-1"></a>            plt.text(</span>
<span id="cb39-233"><a href="#cb39-233" aria-hidden="true" tabindex="-1"></a>                bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb39-234"><a href="#cb39-234" aria-hidden="true" tabindex="-1"></a>                bar.get_height() <span class="op">+</span> <span class="bu">max</span>(params)<span class="op">*</span><span class="fl">0.02</span>,</span>
<span id="cb39-235"><a href="#cb39-235" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>param<span class="sc">}</span><span class="ss">'</span>, </span>
<span id="cb39-236"><a href="#cb39-236" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, </span>
<span id="cb39-237"><a href="#cb39-237" aria-hidden="true" tabindex="-1"></a>                va<span class="op">=</span><span class="st">'bottom'</span>, </span>
<span id="cb39-238"><a href="#cb39-238" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">8</span></span>
<span id="cb39-239"><a href="#cb39-239" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb39-240"><a href="#cb39-240" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-241"><a href="#cb39-241" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reconstruction difference</span></span>
<span id="cb39-242"><a href="#cb39-242" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">21</span>)</span>
<span id="cb39-243"><a href="#cb39-243" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(successful_methods) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb39-244"><a href="#cb39-244" aria-hidden="true" tabindex="-1"></a>            parafac_recon <span class="op">=</span> results[<span class="st">'PARAFAC'</span>][<span class="st">'reconstructed'</span>][:, :, <span class="dv">0</span>] <span class="cf">if</span> <span class="st">'PARAFAC'</span> <span class="kw">in</span> results <span class="kw">and</span> results[<span class="st">'PARAFAC'</span>][<span class="st">'success'</span>] <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb39-245"><a href="#cb39-245" aria-hidden="true" tabindex="-1"></a>            tucker_recon <span class="op">=</span> results[<span class="st">'Tucker'</span>][<span class="st">'reconstructed'</span>][:, :, <span class="dv">0</span>] <span class="cf">if</span> <span class="st">'Tucker'</span> <span class="kw">in</span> results <span class="kw">and</span> results[<span class="st">'Tucker'</span>][<span class="st">'success'</span>] <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb39-246"><a href="#cb39-246" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb39-247"><a href="#cb39-247" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> parafac_recon <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> tucker_recon <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb39-248"><a href="#cb39-248" aria-hidden="true" tabindex="-1"></a>                diff <span class="op">=</span> np.<span class="bu">abs</span>(parafac_recon <span class="op">-</span> tucker_recon)</span>
<span id="cb39-249"><a href="#cb39-249" aria-hidden="true" tabindex="-1"></a>                im <span class="op">=</span> plt.imshow(diff, cmap<span class="op">=</span><span class="st">'plasma'</span>, aspect<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb39-250"><a href="#cb39-250" aria-hidden="true" tabindex="-1"></a>                plt.title(<span class="st">'Reconstruction</span><span class="ch">\n</span><span class="st">Difference'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-251"><a href="#cb39-251" aria-hidden="true" tabindex="-1"></a>                plt.colorbar(im, shrink<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb39-252"><a href="#cb39-252" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb39-253"><a href="#cb39-253" aria-hidden="true" tabindex="-1"></a>                plt.text(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="st">'Cannot compute</span><span class="ch">\n</span><span class="st">difference'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, </span>
<span id="cb39-254"><a href="#cb39-254" aria-hidden="true" tabindex="-1"></a>                        transform<span class="op">=</span>ax.transAxes, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-255"><a href="#cb39-255" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb39-256"><a href="#cb39-256" aria-hidden="true" tabindex="-1"></a>            plt.text(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="st">'Need both methods</span><span class="ch">\n</span><span class="st">for comparison'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, </span>
<span id="cb39-257"><a href="#cb39-257" aria-hidden="true" tabindex="-1"></a>                    transform<span class="op">=</span>ax.transAxes, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-258"><a href="#cb39-258" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-259"><a href="#cb39-259" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compression comparison</span></span>
<span id="cb39-260"><a href="#cb39-260" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">22</span>)</span>
<span id="cb39-261"><a href="#cb39-261" aria-hidden="true" tabindex="-1"></a>        compressions <span class="op">=</span> [np.prod(X_tensor.shape) <span class="op">/</span> result[<span class="st">'params'</span>] <span class="cf">for</span> result <span class="kw">in</span> results.values() <span class="cf">if</span> result[<span class="st">'success'</span>]]</span>
<span id="cb39-262"><a href="#cb39-262" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> plt.bar(methods, compressions, color<span class="op">=</span>colors_comp, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb39-263"><a href="#cb39-263" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Compression Ratio'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-264"><a href="#cb39-264" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Compression'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb39-265"><a href="#cb39-265" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb39-266"><a href="#cb39-266" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-267"><a href="#cb39-267" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bar, comp <span class="kw">in</span> <span class="bu">zip</span>(bars, compressions):</span>
<span id="cb39-268"><a href="#cb39-268" aria-hidden="true" tabindex="-1"></a>            plt.text(</span>
<span id="cb39-269"><a href="#cb39-269" aria-hidden="true" tabindex="-1"></a>                bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb39-270"><a href="#cb39-270" aria-hidden="true" tabindex="-1"></a>                bar.get_height() <span class="op">+</span> <span class="bu">max</span>(compressions)<span class="op">*</span><span class="fl">0.02</span>,</span>
<span id="cb39-271"><a href="#cb39-271" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>comp<span class="sc">:.2f}</span><span class="ss">x'</span>, </span>
<span id="cb39-272"><a href="#cb39-272" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, </span>
<span id="cb39-273"><a href="#cb39-273" aria-hidden="true" tabindex="-1"></a>                va<span class="op">=</span><span class="st">'bottom'</span>, </span>
<span id="cb39-274"><a href="#cb39-274" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">8</span></span>
<span id="cb39-275"><a href="#cb39-275" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb39-276"><a href="#cb39-276" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-277"><a href="#cb39-277" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Explained variance comparison</span></span>
<span id="cb39-278"><a href="#cb39-278" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">23</span>)</span>
<span id="cb39-279"><a href="#cb39-279" aria-hidden="true" tabindex="-1"></a>        explained_vars <span class="op">=</span> [(<span class="dv">1</span> <span class="op">-</span> result[<span class="st">'rel_error'</span>]<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> <span class="dv">100</span> <span class="cf">for</span> result <span class="kw">in</span> results.values() <span class="cf">if</span> result[<span class="st">'success'</span>]]</span>
<span id="cb39-280"><a href="#cb39-280" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> plt.bar(methods, explained_vars, color<span class="op">=</span>colors_comp, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb39-281"><a href="#cb39-281" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Explained Variance'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-282"><a href="#cb39-282" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Variance (%)'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb39-283"><a href="#cb39-283" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb39-284"><a href="#cb39-284" aria-hidden="true" tabindex="-1"></a>        plt.ylim([<span class="dv">0</span>, <span class="dv">100</span>])</span>
<span id="cb39-285"><a href="#cb39-285" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-286"><a href="#cb39-286" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bar, var <span class="kw">in</span> <span class="bu">zip</span>(bars, explained_vars):</span>
<span id="cb39-287"><a href="#cb39-287" aria-hidden="true" tabindex="-1"></a>            plt.text(</span>
<span id="cb39-288"><a href="#cb39-288" aria-hidden="true" tabindex="-1"></a>                bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb39-289"><a href="#cb39-289" aria-hidden="true" tabindex="-1"></a>                bar.get_height() <span class="op">+</span> <span class="dv">2</span>,</span>
<span id="cb39-290"><a href="#cb39-290" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>var<span class="sc">:.1f}</span><span class="ss">%'</span>, </span>
<span id="cb39-291"><a href="#cb39-291" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, </span>
<span id="cb39-292"><a href="#cb39-292" aria-hidden="true" tabindex="-1"></a>                va<span class="op">=</span><span class="st">'bottom'</span>, </span>
<span id="cb39-293"><a href="#cb39-293" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">8</span></span>
<span id="cb39-294"><a href="#cb39-294" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb39-295"><a href="#cb39-295" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-296"><a href="#cb39-296" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb39-297"><a href="#cb39-297" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="st">'PARAFAC vs Tucker: Comparison Results'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, y<span class="op">=</span><span class="fl">0.98</span>)</span>
<span id="cb39-298"><a href="#cb39-298" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb39-299"><a href="#cb39-299" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb39-300"><a href="#cb39-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-301"><a href="#cb39-301" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _summary(results):</span>
<span id="cb39-302"><a href="#cb39-302" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Print minimal final summary"""</span></span>
<span id="cb39-303"><a href="#cb39-303" aria-hidden="true" tabindex="-1"></a>    successful_methods <span class="op">=</span> [method <span class="cf">for</span> method, result <span class="kw">in</span> results.items() <span class="cf">if</span> result[<span class="st">'success'</span>]]</span>
<span id="cb39-304"><a href="#cb39-304" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-305"><a href="#cb39-305" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> successful_methods:</span>
<span id="cb39-306"><a href="#cb39-306" aria-hidden="true" tabindex="-1"></a>        best_method <span class="op">=</span> <span class="bu">min</span>(successful_methods, key<span class="op">=</span><span class="kw">lambda</span> m: results[m][<span class="st">'rel_error'</span>])</span>
<span id="cb39-307"><a href="#cb39-307" aria-hidden="true" tabindex="-1"></a>        best_result <span class="op">=</span> results[best_method]</span>
<span id="cb39-308"><a href="#cb39-308" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-309"><a href="#cb39-309" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Best performing method: </span><span class="sc">{</span>best_method<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb39-310"><a href="#cb39-310" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  • Relative error: </span><span class="sc">{</span>best_result[<span class="st">'rel_error'</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.3f}</span><span class="ss">%"</span>)</span>
<span id="cb39-311"><a href="#cb39-311" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  • Model parameters: </span><span class="sc">{</span>best_result[<span class="st">'params'</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> compare_optimized_models(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    X_tensor, </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    parafac_rank<span class="op">=</span><span class="dv">7</span>, </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    tucker_ranks<span class="op">=</span>[<span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">5</span>]</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best performing method: Tucker
  • Relative error: 4.703%
  • Model parameters: 405</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-39-25.png" class="img-fluid figure-img" width="1920"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Althrough, both methods achieve high explained variance (over 95%), but Tucker’s additional parameters allow it to capture subtle patterns that PARAFAC’s constrained structure cannot represent. In other word, PARAFAC offers cleaner, more interpretable results, while Tucker provides superior reconstruction quality for applications where accuracy trumps interpretability.</p>
<p>The comparison suggests that for our tongue shape data, both methods successfully identify meaningful patterns, but serve different analytical purposes depending on whether the priority is understanding the underlying structure or achieving the most accurate data representation.</p>
</section>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/christiangoueguel\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "ChristianGoueguel/christiangoueguel.github.io";
    script.dataset.repoId = "R_kgDONaeuNQ";
    script.dataset.category = "General";
    script.dataset.categoryId = "";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<div style="text-align: center;">
<p>© 2025 Christian L. Goueguel. All rights reserved, unless otherwise specified.</p>
</div>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>